<!doctype html>
<html lang="zh-CN">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Studyflow Â· ç®¡ç†åå°</title>
  <link rel="stylesheet" href="styles.css">
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
  <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.1/dist/chart.umd.min.js"></script>
  <style>
    :root {
      --primary: #2b6ef2;
      --primary-hover: #1f5fe0;
      --primary-light: #eef4ff;
      --success: #12b76a;
      --success-light: #ecfdf3;
      --error: #f04438;
      --error-light: #fef3f2;
      --warning: #f79009;
      --text-primary: #1a1f2c;
      --text-secondary: #667085;
      --text-muted: #98a2b3;
      --border: #e4e7ec;
      --border-light: #f2f4f7;
      --background: #f9fafb;
      --surface: #ffffff;
      --shadow: 0 20px 40px rgba(16, 24, 40, 0.12);
      --shadow-sm: 0 4px 12px rgba(16, 24, 40, 0.08);
      --radius-lg: 20px;
      --radius-md: 12px;
      --radius-sm: 8px;
      --accent: #7c3aed;
    }

    html, body {
      height: 100%;
      background: linear-gradient(135deg, var(--primary-light) 0%, #f5f7ff 100%);
      font-family: 'Inter', ui-sans-serif, system-ui, -apple-system, sans-serif;
      color: var(--text-primary);
    }

    .admin-header {
      position: sticky;
      top: 0;
      z-index: 20;
      background: rgba(255,255,255,0.9);
      backdrop-filter: blur(10px);
      border-bottom: 1px solid var(--border-light);
    }
    .admin-header-inner {
      max-width: 1320px;
      margin: 0 auto;
      display: flex;
      align-items: center;
      justify-content: space-between;
      padding: 16px 24px;
    }
    .brand {
      display: flex;
      align-items: center;
      gap: 12px;
      font-weight: 800;
      font-size: 20px;
      color: var(--primary);
      text-decoration: none;
    }
    .brand i {
      background: linear-gradient(135deg, var(--primary), #4f86f7);
      -webkit-background-clip: text;
      -webkit-text-fill-color: transparent;
      background-clip: text;
      font-size: 24px;
    }
    .role-switch {
      display: flex;
      align-items: center;
      gap: 8px;
      color: var(--text-secondary);
      font-size: 14px;
    }
    .role-switch select {
      border: 1px solid var(--border);
      border-radius: 10px;
      padding: 8px 12px;
      background: var(--surface);
      color: var(--text-primary);
      outline: none;
    }

    .tabs {
      display: flex;
      gap: 12px;
      padding: 12px 24px;
      max-width: 1320px;
      margin: 0 auto;
      overflow-x: auto;
    }
    .tab-btn {
      border: 1px solid var(--border);
      background: var(--surface);
      color: var(--text-primary);
      padding: 8px 12px;
      border-radius: 12px;
      font-weight: 600;
      cursor: pointer;
      display: inline-flex;
      align-items: center;
      gap: 8px;
      white-space: nowrap;
    }
    .tab-btn.active {
      background: linear-gradient(135deg, var(--primary), #4f86f7);
      color: #fff;
      border-color: transparent;
      box-shadow: 0 6px 16px rgba(43,110,242,0.25);
    }

    .dashboard {
      max-width: 1320px;
      margin: 8px auto 24px;
      padding: 0 24px;
      display: none;
    }
    .grid {
      display: grid;
      gap: 12px;
    }
    .grid.cols-4 {
      grid-template-columns: repeat(4, minmax(0, 1fr));
    }
    .grid.cols-3 {
      grid-template-columns: repeat(3, minmax(0, 1fr));
    }
    .grid.cols-2 {
      grid-template-columns: repeat(2, minmax(0, 1fr));
    }
    @media (max-width: 1100px) {
      .grid.cols-4 { grid-template-columns: repeat(2, minmax(0, 1fr)); }
    }
    @media (max-width: 720px) {
      .grid.cols-4, .grid.cols-3, .grid.cols-2 { grid-template-columns: 1fr; }
    }

    /* ç§»åŠ¨è®¾å¤‡ä¼˜åŒ–æ ·å¼ - å…¨é¢ç¾åŒ– */
    @media (max-width: 768px) {
      /* åŸºç¡€å¸ƒå±€ä¼˜åŒ– */
      .admin-header-inner {
        padding: 12px 16px;
        flex-direction: column;
        align-items: stretch;
        gap: 12px;
      }
      
      .brand {
        justify-content: center;
      }
      
      .role-switch {
        justify-content: space-between;
        background: var(--background);
        padding: 8px 12px;
        border-radius: 8px;
        border: 1px solid var(--border-light);
      }
      
      .tabs {
        padding: 0 16px 12px;
        margin: 0;
        gap: 8px;
        scrollbar-width: none;
        -ms-overflow-style: none;
      }
      .tabs::-webkit-scrollbar { display: none; }
      
      .tab-btn {
        flex: 0 0 auto;
        padding: 8px 16px;
        font-size: 14px;
      }

      .dashboard {
        padding: 0 16px;
        margin-top: 16px;
      }

      /* ç»Ÿè®¡å¡ç‰‡ä¼˜åŒ– */
      .grid.cols-4, .grid.cols-3 {
        grid-template-columns: repeat(2, 1fr) !important;
        gap: 12px;
      }
      
      .stat-card {
        padding: 16px;
      }
      
      .stat-value {
        font-size: 24px;
      }
      
      .stat-title {
        font-size: 13px;
      }

      /* è¡¨æ ¼è½¬å¡ç‰‡è§†å›¾ - æ ¸å¿ƒä¼˜åŒ– */
      .table-container {
        overflow: visible;
        margin: 0;
        padding: 0;
      }

      .table thead { display: none; }

      .table tbody tr {
        display: block;
        background: var(--surface);
        border: none;
        border-radius: 16px;
        margin-bottom: 20px;
        padding: 16px;
        box-shadow: 0 8px 24px rgba(0,0,0,0.06);
        position: relative;
        transition: transform 0.2s;
      }
      
      .table tbody tr:active {
        transform: scale(0.99);
      }

      .table td {
        display: flex;
        justify-content: space-between;
        align-items: center;
        padding: 14px 0;
        border: none;
        border-bottom: 1px dashed var(--border-light);
        text-align: right;
        font-size: 14px;
        color: var(--text-primary);
      }

      .table td:last-child {
        border-bottom: none;
        padding-bottom: 0;
      }

      /* ç”¨æˆ·åˆ—è¡¨æ ‡ç­¾ */
      #usersTable td:nth-of-type(1)::before { content: ""; display: none; }
      #usersTable td:nth-of-type(2)::before { content: "é‚®ç®±"; font-weight: 500; color: var(--text-secondary); font-size: 13px; }
      #usersTable td:nth-of-type(3)::before { content: "è§’è‰²"; font-weight: 500; color: var(--text-secondary); font-size: 13px; }
      #usersTable td:nth-of-type(4)::before { content: "æ³¨å†Œæ—¶é—´"; font-weight: 500; color: var(--text-secondary); font-size: 13px; }
      #usersTable td:nth-of-type(5)::before { content: "çŠ¶æ€"; font-weight: 500; color: var(--text-secondary); font-size: 13px; }

      /* å§“ååˆ—ç‰¹æ®Šå¤„ç† - å¡ç‰‡å¤´éƒ¨é£æ ¼ */
      #usersTable td:nth-of-type(1) {
        border-bottom: 1px solid var(--border-light);
        background: linear-gradient(to right, rgba(43,110,242,0.03), transparent);
        padding: 16px;
        margin: -16px -16px 12px -16px;
        border-radius: 16px 16px 0 0;
        justify-content: space-between;
      }
      
      .name-cell {
        width: 100%;
        display: flex;
        align-items: center;
        justify-content: space-between;
      }
      
      .name-text {
        font-size: 17px;
        font-weight: 700;
        color: var(--text-primary);
      }

      /* åˆ é™¤æŒ‰é’®ç¾åŒ– - ä»…å›¾æ ‡ */
      .name-cell .btn-delete {
        background: transparent;
        border: none;
        padding: 8px;
        box-shadow: none;
        color: var(--text-muted);
        font-size: 0; /* éšè—æ–‡å­— */
        width: 36px;
        height: 36px;
        display: flex;
        align-items: center;
        justify-content: center;
        border-radius: 50%;
      }
      .name-cell .btn-delete i {
        font-size: 16px;
        color: var(--text-muted);
        transition: color 0.2s;
      }
      .name-cell .btn-delete:active {
        background: var(--error-light);
      }
      .name-cell .btn-delete:active i {
        color: var(--error);
      }

      /* åé¦ˆåˆ—è¡¨ä¼˜åŒ– */
      #feedbackTable thead { display: none; }
      #feedbackTable tbody tr {
        display: block;
        background: var(--surface);
        border: 1px solid var(--border-light);
        border-radius: 16px;
        margin-bottom: 16px;
        padding: 16px;
        box-shadow: var(--shadow-sm);
      }
      #feedbackTable td {
        display: block;
        padding: 8px 0;
        border-bottom: 1px solid var(--border-light);
        text-align: left;
      }
      #feedbackTable td:last-child { border-bottom: none; }

      /* å¼¹çª—ä¼˜åŒ– */
      .modal-content {
        width: 92%;
        margin: 20px auto;
        max-height: 90vh;
        overflow-y: auto;
        border-radius: 20px;
      }
      
      .detail-item {
        grid-template-columns: 80px 1fr;
        gap: 12px;
      }
      
      /* å…¶ä»–å¾®è°ƒ */
      .panel {
        border-radius: 16px;
      }
      
      .chart-area {
        height: 200px;
      }
      
      /* ç´§å‡‘ç»Ÿè®¡å¡ç‰‡ç½‘æ ¼ä¼˜åŒ– */
      .compact-stats-grid {
        gap: 8px;
        padding-bottom: 8px; /* ä¸ºæ»šåŠ¨æ¡ç•™ç©º */
      }
      .compact-stat-card {
        min-width: 100px;
        padding: 12px;
      }
    }
    
    @media (max-width: 480px) {
      .admin-header {
        flex-direction: column;
        gap: 8px;
        align-items: flex-start;
      }
      
      .header-actions {
        width: 100%;
        justify-content: space-between;
      }
      
      .tabs {
        overflow-x: auto;
        padding-bottom: 4px;
      }
      
      .tab-btn {
        white-space: nowrap;
        flex-shrink: 0;
      }
      
      .user-item {
        flex-direction: column;
        align-items: flex-start;
        gap: 8px;
      }
      
      .user-actions {
        width: 100%;
        justify-content: flex-end;
      }
      
      .maintenance-item {
        flex-direction: column;
        align-items: flex-start;
        gap: 8px;
      }
      
      .maintenance-actions {
        width: 100%;
        justify-content: flex-end;
      }
    }

    .stat-card {
      background: var(--surface);
      border: 1px solid var(--border-light);
      border-radius: var(--radius-lg);
      padding: 14px;
      box-shadow: var(--shadow-sm);
      display: grid;
      gap: 8px;
    }
    .stat-title { color: var(--text-secondary); font-size: 12px; font-weight: 600; }
    .stat-value { font-size: 24px; font-weight: 800; color: var(--text-primary); }
    .stat-trend { font-size: 11px; font-weight: 600; }
    .up { color: var(--success); }
    .down { color: var(--error); }

    /* ç´§å‡‘ç»Ÿè®¡å¡ç‰‡å¸ƒå±€ */
    .compact-stats-grid {
      display: flex;
      flex-direction: row;
      gap: 8px;
      justify-content: space-between;
      flex-wrap: nowrap;
      overflow-x: auto;
    }
    
    .compact-stat-card {
      background: var(--surface);
      border: 1px solid var(--border-light);
      border-radius: var(--radius-md);
      padding: 12px 8px;
      box-shadow: var(--shadow-sm);
      flex: 1;
      min-width: 0;
      display: flex;
      flex-direction: column;
      align-items: center;
      text-align: center;
    }
    
    .compact-stat-value {
      font-size: 18px;
      font-weight: 800;
      color: var(--text-primary);
      line-height: 1.2;
      margin-bottom: 2px;
    }
    
    .compact-stat-title {
      color: var(--text-secondary);
      font-size: 11px;
      font-weight: 500;
      line-height: 1.2;
      margin-bottom: 4px;
    }
    
    .compact-stat-trend {
      font-size: 10px;
      font-weight: 600;
      padding: 2px 4px;
      border-radius: 4px;
      background: var(--background);
    }
    
    /* å“åº”å¼è°ƒæ•´ */
    @media (max-width: 1024px) {
      .compact-stat-card {
        padding: 10px 6px;
        min-width: 80px;
      }
      
      .compact-stat-value {
        font-size: 16px;
      }
      
      .compact-stat-title {
        font-size: 10px;
      }
    }
    
    @media (max-width: 768px) {
      .compact-stats-grid {
        gap: 6px;
      }
      
      .compact-stat-card {
        padding: 8px 4px;
        min-width: 70px;
      }
      
      .compact-stat-value {
        font-size: 14px;
      }
      
      .compact-stat-title {
        font-size: 9px;
      }
      
      .compact-stat-trend {
        font-size: 9px;
        padding: 1px 3px;
      }
    }

    .panel {
      background: var(--surface);
      border: 1px solid var(--border-light);
      border-radius: var(--radius-lg);
      padding: 12px;
      box-shadow: var(--shadow-sm);
    }
    .panel-header {
      display: flex;
      align-items: center;
      justify-content: space-between;
      margin-bottom: 8px;
    }
    .panel-title { font-size: 15px; font-weight: 700; }

    .table {
      width: 100%;
      border-collapse: collapse;
      border-radius: 12px;
      overflow: hidden;
    }
    .table th, .table td {
      border-bottom: 1px solid var(--border-light);
      padding: 12px;
      text-align: left;
      font-size: 14px;
    }
    .table th {
      background: #f7f9ff;
      color: var(--text-secondary);
      font-weight: 700;
    }
    .status {
      border-radius: 999px;
      padding: 4px 10px;
      font-size: 12px;
      font-weight: 700;
      display: inline-block;
    }
    .status.active { background: var(--success-light); color: var(--success); }
    .status.idle { background: #fff6ed; color: #f97316; }
    .status.lost { background: #f3f4f6; color: #6b7280; }

      .actions { display: flex; gap: 8px; }
    .btn {
      padding: 10px 14px;
      border: 1px solid var(--border);
      border-radius: 10px;
      background: var(--surface);
      cursor: pointer;
      font-weight: 600;
      color: var(--text-primary);
    }
    .btn:hover { transform: translateY(-1px); box-shadow: 0 6px 16px rgba(16,24,40,0.06); }
    .btn-primary { background: var(--primary); color: white; border-color: transparent; }
    .btn-primary:hover { background: var(--primary-hover); }
    .btn-danger { background: var(--error); border-color: transparent; color: white; }
    .btn-ghost { background: transparent; }
    .btn-sm { padding: 4px 8px; font-size: 12px; border-radius: 6px; }

    .name-cell { display: flex; align-items: center; justify-content: space-between; gap: 8px; }
    .name-text { overflow: hidden; text-overflow: ellipsis; white-space: nowrap; }

    .two-col {
      display: grid;
      grid-template-columns: 1fr 1fr;
      gap: 12px;
    }
    @media (max-width: 900px) { .two-col { grid-template-columns: 1fr; } }

    .toast {
      position: fixed;
      right: 16px;
      bottom: 16px;
      background: var(--text-primary);
      color: white;
      padding: 12px 16px;
      border-radius: 10px;
      box-shadow: var(--shadow);
      display: none;
      z-index: 50;
      font-size: 14px;
    }

    .auth-gate {
      position: fixed;
      inset: 0;
      display: grid;
      place-items: center;
      background: linear-gradient(135deg, var(--primary-light) 0%, #f2f6ff 100%);
      z-index: 100;
    }
    .auth-card {
      width: 100%;
      max-width: 440px;
      background: var(--surface);
      border: 1px solid var(--border-light);
      border-radius: 20px;
      box-shadow: var(--shadow);
      padding: 28px;
    }
    .auth-header { text-align: center; margin-bottom: 16px; }
    .auth-title { font-weight: 800; font-size: 22px; background: linear-gradient(135deg, var(--primary), #4f86f7); -webkit-background-clip: text; -webkit-text-fill-color: transparent; background-clip: text; }
    .auth-subtitle { color: var(--text-secondary); font-size: 14px; }
    .input-row { margin-top: 16px; position: relative; }
    .input-row input {
      width: 100%;
      padding: 12px 40px 12px 12px;
      font-size: 15px;
      border: 2px solid var(--border);
      border-radius: 12px;
      outline: none;
      background: var(--background);
    }
    .input-row input:focus { border-color: var(--primary); background: var(--surface); box-shadow: 0 0 0 4px rgba(43,110,242,0.08); }
    .toggle-eye {
      position: absolute;
      right: 10px;
      top: 50%;
      transform: translateY(-50%);
      background: none;
      border: none;
      color: var(--text-muted);
      cursor: pointer;
    }
    .auth-error { display: none; margin-top: 10px; color: var(--error); font-size: 13px; }
    .auth-actions { margin-top: 16px; display: grid; gap: 10px; }

    .hidden { display: none !important; }

    .help { font-size: 13px; color: var(--text-secondary); line-height: 1.7; }
    .help ul { padding-left: 18px; }
    .help li { margin: 4px 0; }

    .chart-area { position: relative; height: 220px; max-height: 260px; min-height: 180px; }
    .chart-area canvas { width: 100% !important; height: 100% !important; }
    
    .pagination-controls {
      display: flex;
      align-items: center;
      justify-content: center;
      gap: 16px;
      padding: 16px;
      border-top: 1px solid var(--border-light);
    }
    .page-info {
      font-size: 14px;
      color: var(--text-secondary);
      font-weight: 500;
    }

    /* åé¦ˆé¡µé¢ä¸“ç”¨æ ·å¼ */
    .filter-bar {
      display: flex;
      align-items: center;
      gap: 12px;
      flex-wrap: wrap;
      padding: 12px 16px;
      background: var(--surface);
      border-radius: var(--radius-md);
      border: 1px solid var(--border-light);
    }
    .filter-group {
      display: flex;
      align-items: center;
      gap: 8px;
    }
    .filter-group label {
      font-size: 13px;
      font-weight: 500;
      color: var(--text-secondary);
      white-space: nowrap;
    }
    .filter-select, .filter-input {
      padding: 6px 10px;
      border: 1px solid var(--border);
      border-radius: 6px;
      font-size: 13px;
      background: var(--surface);
    }
    .stat-subtitle {
      font-size: 11px;
      color: var(--text-muted);
      margin-top: 2px;
    }
    .chart-legend {
      display: flex;
      gap: 8px;
      font-size: 11px;
      color: var(--text-secondary);
    }
    .keywords-container {
      padding: 12px;
      display: grid;
      gap: 6px;
    }
    .keyword-item {
      display: flex;
      align-items: center;
      justify-content: space-between;
      padding: 6px 8px;
      background: var(--background);
      border-radius: 4px;
      font-size: 13px;
    }
    .keyword-count {
      font-weight: 600;
      color: var(--primary);
    }
    .result-count {
      font-size: 13px;
      color: var(--text-secondary);
      margin-right: auto;
    }
    .feedback-cards {
      display: grid;
      gap: 12px;
      margin: 16px 0;
    }
    .cards-container {
      display: grid;
      grid-template-columns: repeat(auto-fill, minmax(300px, 1fr));
      gap: 12px;
    }
    .feedback-card {
      background: var(--surface);
      border: 1px solid var(--border-light);
      border-radius: var(--radius-md);
      padding: 16px;
      transition: all 0.2s ease;
    }
    .feedback-card:hover {
      transform: translateY(-2px);
      box-shadow: var(--shadow-sm);
    }
    .feedback-header {
      display: flex;
      align-items: center;
      justify-content: space-between;
      margin-bottom: 8px;
    }
    .feedback-user {
      display: flex;
      align-items: center;
      gap: 8px;
    }
    .feedback-avatar {
      width: 32px;
      height: 32px;
      border-radius: 50%;
      background: linear-gradient(135deg, var(--primary), #4f86f7);
      display: flex;
      align-items: center;
      justify-content: center;
      color: white;
      font-weight: 600;
      font-size: 14px;
    }
    .feedback-info {
      flex: 1;
    }
    .feedback-name {
      font-weight: 600;
      font-size: 14px;
      color: var(--text-primary);
    }
    .feedback-role {
      font-size: 12px;
      color: var(--text-secondary);
    }
    .feedback-rating {
      display: flex;
      align-items: center;
      gap: 4px;
      font-size: 18px;
      color: #f59e0b;
    }
    .feedback-content {
      margin: 8px 0;
      font-size: 14px;
      line-height: 1.5;
      color: var(--text-primary);
    }
    .feedback-time {
      font-size: 12px;
      color: var(--text-muted);
      text-align: right;
    }
    
    /* åˆ†ç±»æ ‡ç­¾æ ·å¼ */
    .category-badge {
      display: inline-block;
      padding: 2px 8px;
      border-radius: 12px;
      font-size: 11px;
      font-weight: 600;
      margin-right: 8px;
      margin-bottom: 4px;
    }
    
    .category-issue {
      background: var(--error-light);
      color: var(--error);
      border: 1px solid var(--error-light);
    }
    
    .category-feature {
      background: var(--success-light);
      color: var(--success);
      border: 1px solid var(--success-light);
    }

    .feedback-actions {
      margin-top: 12px;
      padding-top: 12px;
      border-top: 1px solid var(--border-light);
      display: flex;
      justify-content: flex-end;
    }
    
    .pagination {
      display: flex;
      align-items: center;
      justify-content: center;
      gap: 16px;
      padding: 12px;
    }
    .page-info {
      font-size: 13px;
      color: var(--text-secondary);
    }
  </style>
</head>
<body>
  <div class="auth-gate" id="authGate">
    <div class="auth-card">
      <div class="auth-header">
        <div style="display:flex;align-items:center;justify-content:center;gap:10px;margin-bottom:10px;">
          <i class="fas fa-graduation-cap" style="font-size:28px;color:var(--primary);"></i>
          <div style="font-weight:800;color:var(--primary);">Studyflow ç®¡ç†åå°</div>
        </div>
        <div class="auth-title">è®¿é—®å—é™</div>
        <div class="auth-subtitle">è¯·è¾“å…¥è®¿é—®å¯†ç ä»¥è¿›å…¥åå°</div>
      </div>
      <div class="input-row">
        <input id="adminPassword" type="password" placeholder="è¾“å…¥å¯†ç " autocomplete="current-password" />
        <button class="toggle-eye" id="toggleEye" aria-label="æ˜¾ç¤º/éšè—å¯†ç "><i class="fas fa-eye"></i></button>
      </div>
      <div id="authError" class="auth-error">å¯†ç é”™è¯¯ï¼Œè¯·é‡è¯•</div>
      <div class="auth-actions">
        <button id="enterBtn" class="btn btn-primary"><i class="fas fa-unlock"></i> è¿›å…¥åå°</button>
      </div>
    </div>
  </div>

  <header class="admin-header">
    <div class="admin-header-inner">
      <a class="brand" href="#">
        <i class="fas fa-book-open"></i>
        <span>Studyflow Admin</span>
      </a>
      <div class="role-switch">
        <i class="fas fa-user-group"></i>
        <span>è§†å›¾ï¼š</span>
        <select id="roleFilter">
          <option value="all">å…¨éƒ¨</option>
          <option value="parent">å®¶é•¿</option>
          <option value="student">å­¦ç”Ÿ</option>
        </select>
      </div>
    </div>
    <div class="tabs">
      <button class="tab-btn active" data-target="tab-users"><i class="fas fa-users"></i> æ³¨å†Œç”¨æˆ·</button>
      <button class="tab-btn" data-target="tab-behavior"><i class="fas fa-chart-line"></i> ç”¨æˆ·è¡Œä¸º</button>
      <button class="tab-btn" data-target="tab-feedback"><i class="fas fa-comments"></i> åé¦ˆä¸è°ƒæŸ¥</button>
      <button class="tab-btn" data-target="tab-db"><i class="fas fa-database"></i> æ•°æ®åº“ç»´æŠ¤</button>
      <button class="tab-btn" data-target="tab-payment"><i class="fas fa-credit-card"></i> ä»˜è´¹ç»Ÿè®¡</button>
    </div>
  </header>

  <main class="dashboard" id="dashboard">
    <section id="tab-users">
      <div class="grid cols-4" style="margin:16px 0;">
        <div class="stat-card">
          <div class="stat-title">æ³¨å†Œç”¨æˆ·æ€»æ•°</div>
          <div class="stat-value" id="usersTotal">0</div>
          <div class="stat-trend up" id="usersGrowth">+0%</div>
        </div>
        <div class="stat-card">
          <div class="stat-title">å®¶é•¿</div>
          <div class="stat-value" id="parentsTotal">0</div>
          <div class="stat-trend" style="color:#7c3aed" id="parentsRatio">0%</div>
        </div>
        <div class="stat-card">
          <div class="stat-title">å­¦ç”Ÿ</div>
          <div class="stat-value" id="studentsTotal">0</div>
          <div class="stat-trend" style="color:#0ea5e9" id="studentsRatio">0%</div>
        </div>
        <div class="stat-card">
          <div class="stat-title">è¿‘7æ—¥æ–°å¢</div>
          <div class="stat-value" id="usersNew7">0</div>
          <div class="stat-trend up" id="usersNewTrend">+0%</div>
        </div>
      </div>
      <div class="panel help" style="margin-bottom:12px;">
        <div class="panel-header"><div class="panel-title">ä½¿ç”¨è¯´æ˜</div></div>
        <ul>
          <li>å³ä¸Šè§’å¯åˆ‡æ¢è§†å›¾ï¼šå…¨éƒ¨/å®¶é•¿/å­¦ç”Ÿï¼Œå½±å“ç»Ÿè®¡ä¸åˆ—è¡¨ã€‚</li>
          <li>è§’è‰²å æ¯”å±•ç¤ºå®¶é•¿ä¸å­¦ç”Ÿæ¯”ä¾‹ï¼›æ³¨å†Œè¶‹åŠ¿å±•ç¤ºè¿‘30æ—¥æ–°å¢ã€‚</li>
          <li>ç”¨æˆ·åˆ—è¡¨æ”¯æŒåˆ·æ–°ä¸å¯¼å‡º CSVï¼Œç”¨äºç¦»çº¿åˆ†æã€‚</li>
        </ul>
      </div>
      <div class="two-col" style="margin-bottom:12px;">
        <div class="panel">
          <div class="panel-header">
            <div class="panel-title">è§’è‰²å æ¯”</div>
          </div>
          <div class="chart-area"><canvas id="chartUsersRole"></canvas></div>
        </div>
        <div class="panel">
          <div class="panel-header">
            <div class="panel-title">æ³¨å†Œè¶‹åŠ¿ï¼ˆè¿‘30æ—¥ï¼‰</div>
          </div>
          <div class="chart-area"><canvas id="chartUsersTrend"></canvas></div>
        </div>
      </div>
      <div class="panel">
        <div class="panel-header">
          <div class="panel-title">ç”¨æˆ·åˆ—è¡¨</div>
          <div class="actions">
            <button class="btn btn-ghost" id="exportUsers"><i class="fas fa-download"></i> å¯¼å‡º</button>
            <button class="btn" id="refreshUsers"><i class="fas fa-rotate"></i> åˆ·æ–°</button>
          </div>
        </div>
        <div class="table-container">
          <table class="table" id="usersTable">
            <thead>
              <tr>
                <th>å§“å</th>
                <th>é‚®ç®±</th>
                <th>è§’è‰²</th>
                <th>æ³¨å†Œæ—¶é—´</th>
                <th>çŠ¶æ€</th>
              </tr>
            </thead>
            <tbody></tbody>
          </table>
        </div>
        <div class="pagination-controls" id="usersPagination">
          <button class="btn btn-sm btn-ghost" id="prevPage"><i class="fas fa-chevron-left"></i> ä¸Šä¸€é¡µ</button>
          <span class="page-info">ç¬¬ <span id="currPage">1</span> é¡µ / å…± <span id="totalPages">1</span> é¡µ</span>
          <button class="btn btn-sm btn-ghost" id="nextPage">ä¸‹ä¸€é¡µ <i class="fas fa-chevron-right"></i></button>
        </div>
      </div>
    </section>

    <section id="tab-behavior" class="hidden">
      <div class="grid cols-4" style="margin:16px 0;">
        <div class="stat-card">
          <div class="stat-title">DAU</div>
          <div class="stat-value" id="dau">0</div>
          <div class="stat-trend up" id="dauTrend">+0%</div>
        </div>
        <div class="stat-card">
          <div class="stat-title">WAU</div>
          <div class="stat-value" id="wau">0</div>
          <div class="stat-trend up" id="wauTrend">+0%</div>
        </div>
        <div class="stat-card">
          <div class="stat-title">MAU</div>
          <div class="stat-value" id="mau">0</div>
          <div class="stat-trend up" id="mauTrend">+0%</div>
        </div>
        <div class="stat-card">
          <div class="stat-title">å¹³å‡ä¼šè¯æ—¶é•¿</div>
          <div class="stat-value" id="avgSession">0m</div>
          <div class="stat-trend up" id="avgSessionTrend">+0%</div>
        </div>
      </div>
      <div class="grid cols-4" style="margin:16px 0;">
        <div class="stat-card">
          <div class="stat-title">æ¬¡æ—¥ç•™å­˜</div>
          <div class="stat-value" id="retention">0%</div>
          <div class="stat-trend up" id="retentionTrend">+0%</div>
        </div>
        <div class="stat-card">
          <div class="stat-title">30å¤©ä¼šè¯æ•°</div>
          <div class="stat-value" id="sessions30">0</div>
          <div class="stat-trend up" id="sessions30Trend">+0%</div>
        </div>
        <div class="stat-card">
          <div class="stat-title">é«˜æ´»è·ƒç”¨æˆ·</div>
          <div class="stat-value" id="highEngagement">0</div>
          <div class="stat-trend up" id="highEngagementTrend">+0%</div>
        </div>
        <div class="stat-card">
          <div class="stat-title">ä¸­æ´»è·ƒç”¨æˆ·</div>
          <div class="stat-value" id="mediumEngagement">0</div>
          <div class="stat-trend up" id="mediumEngagementTrend">+0%</div>
        </div>
      </div>
      <div class="panel help" style="margin-bottom:12px;">
        <div class="panel-header"><div class="panel-title">ä½¿ç”¨è¯´æ˜</div></div>
        <ul>
          <li>DAU/WAU/MAU åˆ†åˆ«ä»£è¡¨æ—¥æ´»ã€å‘¨æ´»ã€æœˆæ´»ï¼Œåæ˜ ä½¿ç”¨ç²˜æ€§ã€‚</li>
          <li><strong>30å¤©æ€»ä¼šè¯æ•°</strong>: è¿‡å»30å¤©å†…æ‰€æœ‰å­¦ä¹ ä¼šè¯çš„æ€»æ¬¡æ•°</li>
          <li><strong>æ—¥å‡ä¼šè¯æ•°</strong>: 30å¤©å†…å¹³å‡æ¯å¤©çš„ä¼šè¯æ¬¡æ•°</li>
          <li><strong>é«˜æ´»è·ƒç”¨æˆ·</strong>: æ¯å‘¨ä½¿ç”¨3æ¬¡ä»¥ä¸Šçš„æ·±åº¦ç”¨æˆ·</li>
          <li><strong>ä¸­æ´»è·ƒç”¨æˆ·</strong>: æ¯å‘¨ä½¿ç”¨1-2æ¬¡çš„å¸¸è§„ç”¨æˆ·</li>
          <li>æ´»è·ƒè¶‹åŠ¿å›¾è¡¨å±•ç¤ºè¿‡å»30å¤©æ¯å¤©çš„æ´»è·ƒç”¨æˆ·æ•°é‡å˜åŒ–</li>
          <li>åŠŸèƒ½ä½¿ç”¨åˆ†å¸ƒç”¨äºè¯†åˆ«æ ¸å¿ƒå­¦ä¹ åœºæ™¯å æ¯”ï¼ŒæŒ‡å¯¼äº§å“ä¼˜åŒ–</li>
        </ul>
      </div>
      <div class="panel" style="margin-bottom:12px;">
        <div class="panel-header">
          <div class="panel-title">Weekly Report Banner æ§åˆ¶</div>
          <div class="actions">
            <button class="btn btn-primary" id="toggleBanner">
              <i class="fas fa-eye"></i> æ˜¾ç¤º/éšè— Banner
            </button>
          </div>
        </div>
        <div class="panel-body">
          <p style="margin:0;color:var(--text-secondary);font-size:14px;">
            æ§åˆ¶ Weekly Report é¡µé¢ä¸­çš„ "More Learning Resources" banner æ˜¾ç¤ºçŠ¶æ€ã€‚
            å…³é—­å banner å°†ä¸ä¼šåœ¨ app ä¸­æ˜¾ç¤ºã€‚
          </p>
          <div style="margin-top:12px;padding:12px;background:var(--border-light);border-radius:var(--radius-sm);">
            <div style="display:flex;align-items:center;gap:8px;">
              <i class="fas fa-info-circle" style="color:var(--primary);"></i>
              <span style="font-size:13px;color:var(--text-secondary);">
                å½“å‰çŠ¶æ€: <span id="bannerStatus" style="font-weight:500;">åŠ è½½ä¸­...</span>
              </span>
            </div>
          </div>
        </div>
      </div>

      <!-- Home Page Banner é…ç½® -->
      <div class="panel banner-config-panel" style="margin-bottom:20px;">
        <div class="panel-header">
          <div class="panel-title">
            <i class="fas fa-image" style="margin-right:8px;color:var(--primary);"></i>
            Home Page Banner é…ç½®
          </div>
          <div class="actions">
            <button class="btn btn-primary" id="saveBannerConfig">
              <i class="fas fa-save"></i> ä¿å­˜é…ç½®
            </button>
          </div>
        </div>
        <div class="panel-body">
          <div class="banner-config-grid">
            <!-- å·¦ä¾§é…ç½®è¡¨å• -->
            <div class="banner-config-form">
              <div class="form-group">
                <label for="bannerTitle" class="form-label">
                  <i class="fas fa-heading" style="margin-right:6px;color:var(--primary);"></i>
                  Banner æ ‡é¢˜
                </label>
                <input type="text" id="bannerTitle" class="form-control modern-input" 
                       placeholder="è¾“å…¥å¸å¼•äººçš„æ ‡é¢˜æ–‡å­—" 
                       value="Stop Studying Hard. Start Studying Smart.">
              </div>
              
              <div class="form-group">
                <label for="bannerUrl" class="form-label">
                  <i class="fas fa-link" style="margin-right:6px;color:var(--primary);"></i>
                  ç‚¹å‡»è·³è½¬é“¾æ¥
                </label>
                <input type="url" id="bannerUrl" class="form-control modern-input" 
                       placeholder="https://example.com" 
                       value="https://studyflow.club/app.html">
                <small class="form-help">ç”¨æˆ·ç‚¹å‡» banner æ—¶å°†è·³è½¬åˆ°æ­¤é“¾æ¥</small>
              </div>
              
              <div class="form-group">
                <label for="bannerVisibility" class="form-label">
                  <i class="fas fa-eye" style="margin-right:6px;color:var(--primary);"></i>
                  æ˜¾ç¤ºè®¾ç½®
                </label>
                <select id="bannerVisibility" class="form-control modern-select">
                  <option value="true">æ˜¾ç¤º banner</option>
                  <option value="false">éšè— banner</option>
                </select>
              </div>
              
              <div class="form-group">
                <label for="reminderTime" class="form-label">
                  <i class="fas fa-clock" style="margin-right:6px;color:var(--primary);"></i>
                  æé†’æ—¶é—´
                </label>
                <input type="time" id="reminderTime" class="form-control modern-input">
                <small class="form-help">è®¾ç½®åï¼Œå·²å®‰è£… app çš„ç”¨æˆ·å°†åœ¨æŒ‡å®šæ—¶é—´æ”¶åˆ°æ¨é€æé†’</small>
              </div>
              
              <div class="form-group checkbox-group">
                <label class="checkbox-label">
                  <input type="checkbox" id="enableReminder" class="modern-checkbox">
                  <span class="checkmark"></span>
                  <i class="fas fa-bell" style="margin-right:6px;color:var(--primary);"></i>
                  å¯ç”¨æé†’åŠŸèƒ½
                </label>
              </div>
            </div>
            
            <!-- å³ä¾§é¢„è§ˆåŒºåŸŸ -->
            <div class="banner-preview-section">
              <div class="preview-header">
                <i class="fas fa-eye" style="margin-right:8px;color:var(--primary);"></i>
                å®æ—¶é¢„è§ˆ
                <span class="preview-badge">å®æ—¶æ›´æ–°</span>
              </div>
              
              <div id="bannerPreview" class="banner-preview">
                <div class="banner-content">
                  <div class="banner-title">Stop Studying Hard. Start Studying Smart.</div>
                  <div class="banner-subtitle">ç‚¹å‡»è·³è½¬åˆ° studyflow.club/app.html</div>
                  <div class="banner-badge">
                    <i class="fas fa-external-link-alt"></i>
                    å¯ç‚¹å‡»
                  </div>
                </div>
                <div class="banner-gradient-overlay"></div>
              </div>
              
              <div class="preview-info">
                <div class="info-item">
                  <i class="fas fa-mobile-alt" style="color:var(--success);"></i>
                  <span>ç§»åŠ¨ç«¯ä¼˜åŒ–</span>
                </div>
                <div class="info-item">
                  <i class="fas fa-paint-brush" style="color:var(--warning);"></i>
                  <span>æ¸å˜è‰²å½©</span>
                </div>
                <div class="info-item">
                  <i class="fas fa-tap" style="color:var(--info);"></i>
                  <span>ç‚¹å‡»äº¤äº’</span>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>
      
      <div class="two-col">
        <div class="panel">
          <div class="panel-header"><div class="panel-title">æ´»è·ƒè¶‹åŠ¿ï¼ˆè¿‘30æ—¥ï¼‰</div></div>
          <div class="chart-area"><canvas id="chartActive"></canvas></div>
        </div>
        <div class="panel">
          <div class="panel-header"><div class="panel-title">åŠŸèƒ½ä½¿ç”¨åˆ†å¸ƒ</div></div>
          <div class="chart-area"><canvas id="chartFeatureUsage"></canvas></div>
        </div>
      </div>
      
      <div class="two-col">
        <div class="panel">
          <div class="panel-header"><div class="panel-title">åŠŸèƒ½ä½¿ç”¨è¶‹åŠ¿ï¼ˆè¿‘30æ—¥ï¼‰</div></div>
          <div class="chart-area"><canvas id="chartFeatureTrends"></canvas></div>
        </div>
        <div class="panel">
          <div class="panel-header"><div class="panel-title">ç”¨æˆ·æ´»è·ƒåº¦åˆ†å¸ƒ</div></div>
          <div class="chart-area"><canvas id="chartUserEngagement"></canvas></div>
        </div>
      </div>
      
      <div class="two-col">
        <div class="panel">
          <div class="panel-header"><div class="panel-title">ä¼šè¯æ—¶é•¿åˆ†å¸ƒ</div></div>
          <div class="chart-area"><canvas id="chartSessionDuration"></canvas></div>
        </div>
        <div class="panel">
          <div class="panel-header"><div class="panel-title">ä½¿ç”¨æ—¶æ®µåˆ†å¸ƒ</div></div>
          <div class="chart-area"><canvas id="chartTimeOfDay"></canvas></div>
        </div>
      </div>
      
      <div class="panel">
        <div class="panel-header"><div class="panel-title">ä¼šè¯æ·±åº¦åˆ†æ</div></div>
        <div class="panel-body">
          <div class="grid cols-3" style="margin-bottom:16px;">
            <div class="stat-card small">
              <div class="stat-title">å¹³å‡æ¯æ—¥ä¼šè¯æ¬¡æ•°</div>
              <div class="stat-value" id="avgSessionsPerDay">0</div>
            </div>
            <div class="stat-card small">
              <div class="stat-title">æœ€é•¿è¿ç»­ä½¿ç”¨å¤©æ•°</div>
              <div class="stat-value" id="maxConsecutiveDays">0</div>
            </div>
            <div class="stat-card small">
              <div class="stat-title">æ€»ä¼šè¯æ¬¡æ•°</div>
              <div class="stat-value" id="totalSessions">0</div>
            </div>
          </div>
          
          <div class="grid cols-2">
            <div class="panel">
              <div class="panel-header"><div class="panel-title">ä¼šè¯å¼ºåº¦åˆ†å¸ƒ</div></div>
              <div class="chart-area"><canvas id="chartSessionIntensity"></canvas></div>
            </div>
            <div class="panel">
              <div class="panel-header"><div class="panel-title">è¯¦ç»†ç»Ÿè®¡</div></div>
              <div class="panel-body">
                <div style="display:grid;grid-template-columns:1fr 1fr;gap:12px;font-size:13px;">
                  <div><strong>çŸ­æ—¶é«˜é¢‘ç”¨æˆ·:</strong> <span id="shortHighIntensity">0</span></div>
                  <div><strong>é•¿æ—¶ä½é¢‘ç”¨æˆ·:</strong> <span id="longLowIntensity">0</span></div>
                  <div><strong>å‡è¡¡ä½¿ç”¨ç”¨æˆ·:</strong> <span id="balancedIntensity">0</span></div>
                  <div><strong>æµ…åº¦ä½¿ç”¨ç”¨æˆ·:</strong> <span id="lightIntensity">0</span></div>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>
    </section>

    <section id="tab-feedback" class="hidden">
      <!-- é¡¶éƒ¨ç­›é€‰æ§åˆ¶æ  -->
      <div class="filter-bar" style="margin-bottom:16px;">
        <div class="filter-group">
          <label>æ—¶é—´èŒƒå›´:</label>
          <select id="timeRangeFilter" class="filter-select">
            <option value="all">å…¨éƒ¨æ—¶é—´</option>
            <option value="7d">æœ€è¿‘7å¤©</option>
            <option value="30d">æœ€è¿‘30å¤©</option>
            <option value="90d">æœ€è¿‘90å¤©</option>
            <option value="custom">è‡ªå®šä¹‰</option>
          </select>
        </div>
        <div class="filter-group" id="customDateRange" style="display:none;">
          <label>å¼€å§‹æ—¥æœŸ:</label>
          <input type="date" id="startDate" class="filter-input">
          <label>ç»“æŸæ—¥æœŸ:</label>
          <input type="date" id="endDate" class="filter-input">
        </div>
        <div class="filter-group">
          <label>ç”¨æˆ·è§’è‰²:</label>
          <select id="roleFilterFeedback" class="filter-select">
            <option value="all">å…¨éƒ¨è§’è‰²</option>
            <option value="student">å­¦ç”Ÿ</option>
            <option value="parent">å®¶é•¿</option>
          </select>
        </div>
        <div class="filter-group">
          <label>è¯„åˆ†:</label>
          <select id="ratingFilter" class="filter-select">
            <option value="all">å…¨éƒ¨è¯„åˆ†</option>
            <option value="5">5æ˜Ÿ</option>
            <option value="4">4æ˜Ÿ</option>
            <option value="3">3æ˜Ÿ</option>
            <option value="2">2æ˜Ÿ</option>
            <option value="1">1æ˜Ÿ</option>
          </select>
        </div>
        <button class="btn btn-primary" id="applyFilters"><i class="fas fa-filter"></i> åº”ç”¨ç­›é€‰</button>
        <button class="btn" id="exportFeedback"><i class="fas fa-download"></i> å¯¼å‡ºæ•°æ®</button>
      </div>

      <!-- ç»Ÿè®¡æ¦‚è§ˆå¡ç‰‡ - ç´§å‡‘å¸ƒå±€ -->
      <div class="compact-stats-grid" style="margin:16px 0;">
        <div class="compact-stat-card">
          <div class="compact-stat-value" id="feedbackCount">0</div>
          <div class="compact-stat-title">æ€»åé¦ˆæ•°</div>
          <div class="compact-stat-trend" id="feedbackTrend">+0%</div>
        </div>
        <div class="compact-stat-card">
          <div class="compact-stat-value" id="avgRating">0.0</div>
          <div class="compact-stat-title">å¹³å‡è¯„åˆ†</div>
          <div class="compact-stat-trend" id="avgRatingTrend">+0%</div>
        </div>
        <div class="compact-stat-card">
          <div class="compact-stat-value" id="uniqueUsers">0</div>
          <div class="compact-stat-title">å‘é€ç”¨æˆ·</div>
          <div class="compact-stat-trend" id="usersTrend">+0%</div>
        </div>
        <div class="compact-stat-card">
          <div class="compact-stat-value" id="positiveRatio">0%</div>
          <div class="compact-stat-title">æ­£å‘åé¦ˆ</div>
          <div class="compact-stat-trend" id="positiveTrend">+0%</div>
        </div>
        <div class="compact-stat-card">
          <div class="compact-stat-value" id="nps">0</div>
          <div class="compact-stat-title">NPSå¾—åˆ†</div>
          <div class="compact-stat-trend" id="npsTrend">+0</div>
        </div>
      </div>

      <!-- åˆ†ç±»ç»Ÿè®¡ -->
      <div class="compact-stats-grid" style="margin:16px 0;background:var(--primary-light);border-radius:var(--radius-md);padding:12px;">
        <div class="compact-stat-card" style="background:var(--error-light);">
          <div class="compact-stat-value" id="issuesCount">0</div>
          <div class="compact-stat-title">é—®é¢˜åé¦ˆ</div>
          <div class="compact-stat-trend">Issues</div>
        </div>
        <div class="compact-stat-card" style="background:var(--success-light);">
          <div class="compact-stat-value" id="featureRequestsCount">0</div>
          <div class="compact-stat-title">åŠŸèƒ½å»ºè®®</div>
          <div class="compact-stat-trend">Feature Requests</div>
        </div>
        <div class="compact-stat-card" style="background:var(--primary-light);flex:2;">
          <div class="compact-stat-value" id="issuesRatio">0%</div>
          <div class="compact-stat-title">é—®é¢˜å æ¯”</div>
          <div class="compact-stat-trend">of Total</div>
        </div>
        <div class="compact-stat-card" style="background:var(--primary-light);flex:2;">
          <div class="compact-stat-value" id="featuresRatio">0%</div>
          <div class="compact-stat-title">å»ºè®®å æ¯”</div>
          <div class="compact-stat-trend">of Total</div>
        </div>
      </div>

      <!-- å›¾è¡¨åˆ†æåŒºåŸŸ -->
      <div class="two-col" style="margin-bottom:12px;">
        <div class="panel">
          <div class="panel-header">
            <div class="panel-title">è¯„åˆ†åˆ†å¸ƒ</div>
            <div class="chart-legend" id="ratingLegend"></div>
          </div>
          <div class="chart-area"><canvas id="chartRatings"></canvas></div>
        </div>
        <div class="panel">
          <div class="panel-header">
            <div class="panel-title">æ—¶é—´è¶‹åŠ¿åˆ†æ</div>
            <div class="chart-legend" id="trendLegend"></div>
          </div>
          <div class="chart-area"><canvas id="chartTrend"></canvas></div>
        </div>
      </div>

      <div class="two-col" style="margin-bottom:12px;">
        <div class="panel">
          <div class="panel-header">
            <div class="panel-title">ç”¨æˆ·è§’è‰²åˆ†å¸ƒ</div>
          </div>
          <div class="chart-area"><canvas id="chartRoles"></canvas></div>
        </div>
        <div class="panel">
          <div class="panel-header">
            <div class="panel-title">å…³é”®è¯åˆ†æ Top10</div>
          </div>
          <div class="keywords-container" id="keywordsList"></div>
        </div>
      </div>

      <!-- è¯¦ç»†åé¦ˆåˆ—è¡¨ -->
      <div class="panel">
        <div class="panel-header">
          <div class="panel-title">åé¦ˆè¯¦æƒ…åˆ—è¡¨</div>
          <div class="actions">
            <span class="result-count" id="feedbackResultCount">æ˜¾ç¤º 0 æ¡ç»“æœ</span>
            <button class="btn" id="refreshFeedback"><i class="fas fa-rotate"></i> åˆ·æ–°</button>
            <button class="btn btn-secondary" id="toggleFeedbackView"><i class="fas fa-table"></i> åˆ‡æ¢è§†å›¾</button>
          </div>
        </div>
        
        <!-- å¡ç‰‡è§†å›¾ -->
        <div id="feedbackCardsView" class="feedback-cards">
          <div class="cards-container" id="feedbackCardsContainer"></div>
        </div>
        
        <!-- è¡¨æ ¼è§†å›¾ -->
        <div id="feedbackTableView" style="display:none;">
          <table class="table" id="feedbackTable">
            <thead>
              <tr>
                <th>æ—¶é—´</th>
                <th>ç”¨æˆ·ä¿¡æ¯</th>
                <th>è§’è‰²</th>
                <th>è¯„åˆ†</th>
                <th>åé¦ˆå†…å®¹</th>
                <th>æ“ä½œ</th>
              </tr>
            </thead>
            <tbody></tbody>
          </table>
        </div>
        
        <div class="pagination" id="feedbackPagination" style="margin-top:16px;">
          <button class="btn btn-sm" id="prevPage">ä¸Šä¸€é¡µ</button>
          <span class="page-info" id="pageInfo">ç¬¬ 1 é¡µ / å…± 1 é¡µ</span>
          <button class="btn btn-sm" id="nextPage">ä¸‹ä¸€é¡µ</button>
        </div>
      </div>
    </section>

    <section id="tab-db" class="hidden">
      <div class="grid cols-3" style="margin:16px 0;">
        <div class="stat-card">
          <div class="stat-title">å­¤ç«‹è®°å½•</div>
          <div class="stat-value" id="orphans">0</div>
          <div class="stat-trend down" id="orphansTrend">-0%</div>
        </div>
        <div class="stat-card">
          <div class="stat-title">é‡å¤æ•°æ®</div>
          <div class="stat-value" id="duplicates">0</div>
          <div class="stat-trend down" id="duplicatesTrend">-0%</div>
        </div>
        <div class="stat-card">
          <div class="stat-title">å¾…å½’æ¡£</div>
          <div class="stat-value" id="archives">0</div>
          <div class="stat-trend down" id="archivesTrend">-0%</div>
        </div>
      </div>
      <div class="panel help" style="margin-bottom:12px;">
        <div class="panel-header"><div class="panel-title">æ•°æ®åº“ç»´æŠ¤åŠŸèƒ½ä½¿ç”¨è¯´æ˜</div></div>
        <div style="padding:12px;">
          
          <div style="margin-bottom:12px; padding:8px; background:var(--success-light); border-radius:var(--radius-sm); border-left:3px solid var(--success);">
            <div style="font-weight:500; color:var(--success); margin-bottom:4px;">âœ… å¤‡ä»½æ•°æ®åº“</div>
            <div style="font-size:13px; color:var(--text-secondary);">
              åˆ›å»ºå®Œæ•´JSONå¤‡ä»½ã€‚å»ºè®®æ¯å‘¨ä½¿ç”¨ï¼Œé‡å¤§å˜æ›´å‰å¿…åšã€‚
            </div>
          </div>
          
          <div style="margin-bottom:12px; padding:8px; background:var(--warning-light); border-radius:var(--radius-sm); border-left:3px solid var(--warning);">
            <div style="font-weight:500; color:var(--warning); margin-bottom:4px;">ğŸ”„ æ¢å¤æ•°æ®åº“</div>
            <div style="font-size:13px; color:var(--text-secondary);">
              ä»å¤‡ä»½æ–‡ä»¶æ¢å¤ã€‚å®‰å…¨æ¨¡å¼é»˜è®¤å¯ç”¨ï¼Œé¿å…æ•°æ®è¦†ç›–ã€‚
            </div>
          </div>
          
          <div style="margin-bottom:12px; padding:8px; background:var(--primary-light); border-radius:var(--radius-sm); border-left:3px solid var(--primary);">
            <div style="font-weight:500; color:var(--primary); margin-bottom:4px;">ğŸ§¹ æ¸…ç†æ®‹ç•™æ•°æ®</div>
            <div style="font-size:13px; color:var(--text-secondary);">
              åˆ é™¤å­¤å„¿è®°å½•ï¼ˆæ— è¯¾ç¨‹å…³è”çš„ä½œä¸š/è€ƒè¯•ï¼‰ã€‚å»ºè®®æ¯æœˆä½¿ç”¨ã€‚
            </div>
          </div>
          
          <div style="margin-bottom:12px; padding:8px; background:var(--primary-light); border-radius:var(--radius-sm); border-left:3px solid var(--primary);">
            <div style="font-weight:500; color:var(--primary); margin-bottom:4px;">ğŸ” å»é‡</div>
            <div style="font-size:13px; color:var(--text-secondary);">
              åˆ é™¤é‡å¤ä½œä¸šè®°å½•ã€‚æŒ‰éœ€ä½¿ç”¨ï¼Œä¿ç•™æœ€æ—©è®°å½•ã€‚
            </div>
          </div>
          
          <div style="margin-bottom:12px; padding:8px; background:var(--border-light); border-radius:var(--radius-sm); border-left:3px solid var(--text-muted);">
            <div style="font-weight:500; color:var(--text-muted); margin-bottom:4px;">ğŸ“Š é‡å»ºç´¢å¼•</div>
            <div style="font-size:13px; color:var(--text-secondary);">
              Noopæ“ä½œï¼ˆSupabaseè‡ªåŠ¨ç®¡ç†ï¼‰ã€‚è‡ªæ‰˜ç®¡ç¯å¢ƒéœ€è¦ã€‚
            </div>
          </div>
          
          <div style="margin-bottom:12px; padding:8px; background:var(--border-light); border-radius:var(--radius-sm); border-left:3px solid var(--text-muted);">
            <div style="font-weight:500; color:var(--text-muted); margin-bottom:4px;">ğŸ—ƒï¸ å½’æ¡£æ—§è®°å½•</div>
            <div style="font-size:13px; color:var(--text-secondary);">
              Noopæ“ä½œï¼ˆè®¾è®¡ç”¨äºå½’æ¡£180å¤©ä»¥ä¸Šä¼šè¯ï¼‰ã€‚è‡ªæ‰˜ç®¡ç¯å¢ƒéœ€è¦ã€‚
            </div>
          </div>
          
          <div style="margin-bottom:12px; padding:8px; background:var(--border-light); border-radius:var(--radius-sm); border-left:3px solid var(--text-muted);">
            <div style="font-weight:500; color:var(--text-muted); margin-bottom:4px;">ğŸ’¾ å‹ç¼©ç©ºé—´</div>
            <div style="font-size:13px; color:var(--text-secondary);">
              Noopæ“ä½œï¼ˆSupabaseè‡ªåŠ¨VACUUMï¼‰ã€‚è‡ªæ‰˜ç®¡ç¯å¢ƒéœ€è¦ã€‚
            </div>
          </div>
          
          <div style="margin-top:16px; padding:12px; background:var(--background); border-radius:var(--radius-sm); border:1px solid var(--border);">
            <div style="font-weight:500; color:var(--text-primary); margin-bottom:8px;">ğŸ›¡ï¸ å®‰å…¨æç¤º</div>
            <div style="font-size:13px; color:var(--text-secondary); line-height:1.4;">
              â€¢ æ‰€æœ‰æ“ä½œéœ€è¦ç®¡ç†å‘˜å¯†ç éªŒè¯<br>
              â€¢ å±é™©æ“ä½œæœ‰æ•°é‡é™åˆ¶ï¼ˆæ¯æ¬¡æœ€å¤š1000æ¡ï¼‰<br>
              â€¢ æ¢å¤åŠŸèƒ½æœ‰å¤šé‡å®‰å…¨ä¿æŠ¤<br>
              â€¢ å»ºè®®æ“ä½œå‰å…ˆå¤‡ä»½æ•°æ®
            </div>
          </div>
          
          <div style="margin-top:16px;padding:12px;background:var(--success-light);border-radius:var(--radius-sm);border-left:4px solid var(--success);">
            <div style="font-weight:500;color:var(--success-dark);margin-bottom:8px;">ğŸ“‹ æ¨èç»´æŠ¤å‘¨æœŸ</div>
            <div style="font-size:13px; color:var(--text-secondary); line-height:1.4;">
              â€¢ <strong>æ¯å‘¨</strong>ï¼šæ•°æ®åº“å¤‡ä»½<br>
              â€¢ <strong>æ¯æœˆ</strong>ï¼šæ¸…ç†æ®‹ç•™æ•°æ®<br>
              â€¢ <strong>æŒ‰éœ€</strong>ï¼šæ•°æ®æ¢å¤ã€å»é‡<br>
              â€¢ <strong>è‡ªåŠ¨</strong>ï¼šç´¢å¼•ã€å½’æ¡£ã€å‹ç¼©ï¼ˆSupabaseæ‰˜ç®¡ï¼‰
            </div>
            <div style="margin-top:8px;font-size:12px;color:var(--success-dark);">
              ğŸ’¡ å»ºè®®åœ¨ä¸šåŠ¡ä½å³°æœŸæ‰§è¡Œç»´æŠ¤æ“ä½œ
            </div>
          </div>
          
        </div>
      </div>
      <div class="panel" style="margin-bottom:12px;">
        <div class="panel-header"><div class="panel-title">ç»´æŠ¤æ“ä½œ</div></div>
        <div class="actions" style="flex-wrap:wrap;">
          <button class="btn btn-success" data-action="backup" id="backupDbBtn">
            <i class="fas fa-database"></i> å¤‡ä»½æ•°æ®åº“
          </button>
          <button class="btn btn-warning" data-action="restore" id="restoreDbBtn">
            <i class="fas fa-undo"></i> æ¢å¤æ•°æ®åº“
          </button>
          <button class="btn btn-danger" data-action="cleanup">æ¸…ç†æ®‹ç•™æ•°æ®</button>
          <button class="btn btn-primary" data-action="dedupe">å»é‡</button>
          <button class="btn" data-action="reindex">é‡å»ºç´¢å¼•</button>
          <button class="btn" data-action="archive">å½’æ¡£æ—§è®°å½•</button>
          <button class="btn" data-action="vacuum">å‹ç¼©ç©ºé—´</button>
        </div>
        
        <!-- æ•°æ®åº“æ¢å¤é¢æ¿ -->
        <div id="restorePanel" style="display:none; margin-top:16px; padding:16px; background:var(--warning-light); border-radius:var(--radius-sm); border-left:4px solid var(--warning);">
          <div style="font-weight:500; color:var(--warning-dark); margin-bottom:12px;">
            <i class="fas fa-exclamation-triangle"></i> æ•°æ®åº“æ¢å¤
          </div>
          <div style="font-size:13px; color:var(--text-secondary); margin-bottom:12px;">
            é€‰æ‹©å¤‡ä»½æ–‡ä»¶è¿›è¡Œæ¢å¤ã€‚æ­¤æ“ä½œä¼šå°†å¤‡ä»½æ•°æ®æ’å…¥åˆ°å½“å‰æ•°æ®åº“ï¼Œä¸ä¼šåˆ é™¤ç°æœ‰æ•°æ®ã€‚
          </div>
          
          <!-- å®‰å…¨é€‰é¡¹ -->
          <div style="margin-bottom:12px; padding:12px; background:var(--surface); border-radius:var(--radius-sm); border:1px solid var(--border);">
            <div style="font-weight:500; margin-bottom:8px; color:var(--text-primary);">å®‰å…¨é€‰é¡¹</div>
            
            <label style="display:flex; align-items:center; margin-bottom:8px; cursor:pointer;">
              <input type="checkbox" id="safeMode" checked style="margin-right:8px;">
              <span>å®‰å…¨æ¨¡å¼</span>
              <span style="margin-left:8px; font-size:12px; color:var(--text-muted);">(é»˜è®¤å¯ç”¨ï¼Œé¿å…è¦†ç›–ç°æœ‰æ•°æ®)</span>
            </label>
            
            <label style="display:flex; align-items:center; margin-bottom:8px; cursor:pointer;">
              <input type="checkbox" id="dryRun" style="margin-right:8px;">
              <span>å¹²è·‘æ¨¡å¼</span>
              <span style="margin-left:8px; font-size:12px; color:var(--text-muted);">(åªéªŒè¯ä¸å®é™…æ’å…¥æ•°æ®)</span>
            </label>
            
            <div style="font-size:12px; color:var(--text-muted); line-height:1.4;">
              <i class="fas fa-info-circle"></i> å®‰å…¨æ¨¡å¼ä¼šå¿½ç•¥é‡å¤è®°å½•ï¼Œå¹²è·‘æ¨¡å¼åªéªŒè¯æ•°æ®æ ¼å¼è€Œä¸å®é™…ä¿®æ”¹æ•°æ®åº“ã€‚
            </div>
          </div>
          
          <input type="file" id="restoreFile" accept=".json" style="margin-bottom:12px;" />
          <div style="display:flex; gap:8px;">
            <button class="btn btn-warning btn-sm" onclick="confirmRestore()">
              <i class="fas fa-play"></i> å¼€å§‹æ¢å¤
            </button>
            <button class="btn btn-secondary btn-sm" onclick="cancelRestore()">
              <i class="fas fa-times"></i> å–æ¶ˆ
            </button>
          </div>
        </div>
      </div>
      <div class="panel">
        <div class="panel-header"><div class="panel-title">æ“ä½œæ—¥å¿—</div></div>
        <div id="dbLogs" style="font-family:ui-monospace, SFMono-Regular, Menlo, monospace; font-size:13px; color:var(--text-secondary); display:grid; gap:6px;"></div>
      </div>
    </section>

    <section id="tab-payment" class="hidden">
      <div class="grid cols-4" style="margin:16px 0;">
        <div class="stat-card">
          <div class="stat-title">æ€»æ”¶å…¥</div>
          <div class="stat-value" id="revenueTotal">$0</div>
          <div class="stat-trend up" id="revenueTrend">+0%</div>
        </div>
        <div class="stat-card">
          <div class="stat-title">ä»˜è´¹ç”¨æˆ·</div>
          <div class="stat-value" id="paidUsers">0</div>
          <div class="stat-trend up" id="paidUsersTrend">+0%</div>
        </div>
        <div class="stat-card">
          <div class="stat-title">è½¬åŒ–ç‡</div>
          <div class="stat-value" id="conversion">0%</div>
          <div class="stat-trend up" id="conversionTrend">+0%</div>
        </div>
        <div class="stat-card">
          <div class="stat-title">æœˆå¢é•¿</div>
          <div class="stat-value" id="mrrGrowth">0%</div>
          <div class="stat-trend up" id="mrrGrowthTrend">+0%</div>
        </div>
      </div>
      <div class="panel help" style="margin-bottom:12px;">
        <div class="panel-header"><div class="panel-title">ä½¿ç”¨è¯´æ˜</div></div>
        <ul>
          <li>æ€»æ”¶å…¥ä¸ºç´¯è®¡æ”¶å…¥ï¼›æœˆåº¦æ”¶å…¥ç”¨äºè§‚å¯Ÿå­£èŠ‚æ€§ã€‚</li>
          <li>ä»˜è´¹ç”¨æˆ·ä¸è½¬åŒ–ç‡ç”¨äºå¢é•¿ä¸æŠ•æ”¾è¯„ä¼°ã€‚</li>
          <li>å¥—é¤åˆ†å¸ƒå¯æŒ‡å¯¼å®šä»·ä¸ä¿ƒé”€ç­–ç•¥ã€‚</li>
        </ul>
      </div>
      <div class="two-col">
        <div class="panel">
          <div class="panel-header"><div class="panel-title">æœˆåº¦æ”¶å…¥</div></div>
          <div class="chart-area"><canvas id="chartRevenue"></canvas></div>
        </div>
        <div class="panel">
          <div class="panel-header"><div class="panel-title">å¥—é¤åˆ†å¸ƒ</div></div>
          <div class="chart-area"><canvas id="chartPlans"></canvas></div>
        </div>
      </div>
    </section>
  </main>

  <div class="toast" id="toast"></div>

  <script>
    // ä»URLå‚æ•°æˆ–SessionStorageè·å–å¯†ç 
    let PASSWORD = getUrlParameter('password') || sessionStorage.getItem('sf_admin_password') || '';
    
    // è·å–URLå‚æ•°çš„è¾…åŠ©å‡½æ•°
    function getUrlParameter(name) {
      if (typeof window === 'undefined') return null;
      name = name.replace(/[\[]/, '\\[').replace(/[\]]/, '\\]');
      const regex = new RegExp('[\\?&]' + name + '=([^&#]*)');
      const results = regex.exec(window.location.search);
      return results === null ? null : decodeURIComponent(results[1].replace(/\+/g, ' '));
    }
    
    // æ™ºèƒ½æ£€æµ‹APIåœ°å€
    const getApiBase = () => {
      // å¦‚æœæ˜¯æœ¬åœ°å¼€å‘ç¯å¢ƒæˆ–å±€åŸŸç½‘è®¿é—®
      if (location.hostname === 'localhost' || 
          location.hostname === '127.0.0.1' || 
          location.hostname.startsWith('192.168.') ||
          location.hostname.startsWith('10.') ||
          location.hostname.startsWith('172.')) {
        return `http://${location.hostname}:8787`;
      }
      // Vercelç¯å¢ƒ - ä½¿ç”¨ç›¸åŒçš„åŸŸåä¸‹çš„APIè·¯å¾„
      if (location.hostname.includes('vercel.app')) {
        return '/api';
      }
      // ç”Ÿäº§ç¯å¢ƒä½¿ç”¨æ­£ç¡®çš„APIåŸŸå
      if (location.hostname === 'studyflow.club') {
        return 'https://studyflow-d2cx5zluv-owens-projects-8a390bfc.vercel.app/api';
      }
      // é»˜è®¤ä½¿ç”¨ç›¸å¯¹è·¯å¾„
      return '/api';
    };
    const API_BASE = getApiBase();
    const $ = (s, r = document) => r.querySelector(s);
    const $$ = (s, r = document) => Array.from(r.querySelectorAll(s));
    const authGate = $('#authGate');
    const dashboard = $('#dashboard');
    const enterBtn = $('#enterBtn');
    const pwdInput = $('#adminPassword');
    const toggleEye = $('#toggleEye');
    const authError = $('#authError');
    const roleFilter = $('#roleFilter');
    const toast = $('#toast');

    let charts = {};
    let currentPage = 1;
    const pageSize = 50;

    function daysAgo(d) { const dt = new Date(); dt.setDate(dt.getDate() - d); return dt.toISOString().slice(0,10); }
    function fmtPct(v) { return `${Number(v||0).toFixed(1)}%`; }
    function fmtMoney(v) { return `$${(Number(v)||0).toLocaleString()}`; }

    async function apiGet(path) {
      const res = await fetch(`${API_BASE}${path}`, { headers: { 'X-Admin-Password': PASSWORD } });
      if (!res.ok) throw new Error(`HTTP ${res.status}`);
      const json = await res.json();
      if (!json.ok) throw new Error(json.error||'API error');
      return json;
    }
    async function apiPost(path, body, opts={}) {
      const headers = { 'Content-Type':'application/json', 'X-Admin-Password': PASSWORD, ...(opts.headers||{}) };
      const res = await fetch(`${API_BASE}${path}`, { method: 'POST', headers, body: JSON.stringify(body||{}) });
      if (!res.ok) throw new Error(`HTTP ${res.status}`);
      const json = await res.json();
      if (!json.ok) throw new Error(json.error||'API error');
      return json;
    }

    async function apiDelete(path, body) {
      const headers = { 'Content-Type':'application/json', 'X-Admin-Password': PASSWORD };
      const res = await fetch(`${API_BASE}${path}`, { method: 'DELETE', headers, body: JSON.stringify(body||{}) });
      if (!res.ok) throw new Error(`HTTP ${res.status}`);
      const json = await res.json();
      if (!json.ok) throw new Error(json.error||'API error');
      return json;
    }

    function showToast(text) {
      toast.textContent = text;
      toast.style.display = 'block';
      setTimeout(()=> toast.style.display = 'none', 2400);
    }

    function unlock() {
      authGate.classList.add('hidden');
      dashboard.style.display = 'block';
      sessionStorage.setItem('sf_admin_unlocked', '1');
    }

    toggleEye.addEventListener('click', () => {
      const isPw = pwdInput.type === 'password';
      pwdInput.type = isPw ? 'text' : 'password';
      toggleEye.innerHTML = isPw ? '<i class="fas fa-eye-slash"></i>' : '<i class="fas fa-eye"></i>';
    });
    enterBtn.addEventListener('click', async () => {
      const inputPwd = pwdInput.value;
      if (!inputPwd) {
        authError.textContent = 'è¯·è¾“å…¥å¯†ç ';
        authError.style.display = 'block';
        return;
      }
      
      enterBtn.disabled = true;
      enterBtn.textContent = 'éªŒè¯ä¸­...';
      
      try {
        // è¯·æ±‚ metrics æ¥å£éªŒè¯å¯†ç 
        const res = await fetch(`${API_BASE}/metrics/users?limit=1`, {
          headers: { 'X-Admin-Password': inputPwd }
        });
        
        if (res.status === 401) {
          throw new Error('å¯†ç é”™è¯¯');
        }
        
        if (!res.ok) {
          throw new Error(`æœåŠ¡å™¨é”™è¯¯ (${res.status})`);
        }
        
        // éªŒè¯é€šè¿‡
        PASSWORD = inputPwd;
        sessionStorage.setItem('sf_admin_password', inputPwd);
        authError.style.display = 'none';
        unlock();
        init();
        
      } catch (e) {
        console.error(e);
        authError.textContent = e.message === 'å¯†ç é”™è¯¯' ? 'å¯†ç é”™è¯¯ï¼Œè¯·é‡è¯•' : 'è¿æ¥æœåŠ¡å™¨å¤±è´¥';
        authError.style.display = 'block';
      } finally {
        enterBtn.disabled = false;
        enterBtn.textContent = 'è¿›å…¥åå°';
      }
    });
    pwdInput.addEventListener('keydown', (e)=>{ if(e.key==='Enter'){ enterBtn.click(); }});

    if (sessionStorage.getItem('sf_admin_unlocked') === '1') {
      unlock();
      init();
    }

    $$('.tab-btn').forEach(btn => {
      btn.addEventListener('click', () => {
        $$('.tab-btn').forEach(b=>b.classList.remove('active'));
        btn.classList.add('active');
        const target = btn.getAttribute('data-target');
        ['tab-users','tab-behavior','tab-feedback','tab-db','tab-payment'].forEach(id => {
          const el = document.getElementById(id);
          if (!el) return;
          if (id === target) el.classList.remove('hidden'); else el.classList.add('hidden');
        });
      });
    });

    roleFilter.addEventListener('change', () => renderAll());

    function init() {
      renderAll().catch(err => { console.error(err); showToast('åç«¯ä¸å¯ç”¨æˆ–æœªé…ç½®'); });
      bindActions();
    }

    function bindActions() {
      $('#refreshUsers').addEventListener('click', async ()=> { try { await renderUsers(); showToast('ç”¨æˆ·æ•°æ®å·²åˆ·æ–°'); } catch(e){ console.error(e); showToast('åˆ·æ–°å¤±è´¥'); } });
      $('#exportUsers').addEventListener('click', ()=> exportTableCSV('#usersTable', 'users.csv'));
      $('#prevPage').addEventListener('click', async () => { if (currentPage > 1) { currentPage--; await renderUsers(); } });
      $('#nextPage').addEventListener('click', async () => { if (!$('#nextPage').disabled) { currentPage++; await renderUsers(); } });

      $('#refreshFeedback').addEventListener('click', async ()=> { try { await renderFeedback(); showToast('åé¦ˆæ•°æ®å·²åˆ·æ–°'); } catch(e){ console.error(e); showToast('åˆ·æ–°å¤±è´¥'); } });
      $('#toggleBanner').addEventListener('click', async ()=> { 
        try { 
          await toggleBannerVisibility(); 
        } catch(e){ 
          console.error(e); 
          showToast('Banner çŠ¶æ€åˆ‡æ¢å¤±è´¥'); 
        } 
      });
      
      // ç»‘å®šæ–°çš„ banner é…ç½®äº‹ä»¶
      bindBannerEvents();
      $$('#tab-db [data-action]').forEach(btn=>{
        const action = btn.getAttribute('data-action');
        if (action === 'restore') {
          btn.addEventListener('click', toggleRestorePanel);
        } else {
          btn.addEventListener('click', ()=> runMaintenance(action));
        }
      });
    }

    

    async function renderAll() {
      const tasks = [
        () => renderUsers(),
        () => renderBehavior(),
        () => renderFeedback(),
        () => renderMaintenance(),
        () => renderPayment(),
      ];
      const results = await Promise.allSettled(tasks.map(t => t()));
      results.forEach((r, i) => {
        if (r.status === 'rejected') {
          const names = ['ç”¨æˆ·','è¡Œä¸º','åé¦ˆ','ç»´æŠ¤','ä»˜è´¹'];
          console.error(`åŠ è½½${names[i]}æ•°æ®å¤±è´¥:`, r.reason);
        }
      });
    }

    async function renderUsers() {
      const role = roleFilter.value;
      const metrics = await apiGet(`/metrics/users?role=${encodeURIComponent(role)}`);
      const listRes = await apiGet(`/users?role=${encodeURIComponent(role)}&page=${currentPage}&limit=${pageSize}`);

      const total = metrics.metrics.total;
      const parents = metrics.metrics.parents;
      const students = metrics.metrics.students;
      const pRatio = parents/(parents+students||1)*100;
      const sRatio = 100 - pRatio;

      $('#usersTotal').textContent = String(total);
      $('#parentsTotal').textContent = String(parents);
      $('#studentsTotal').textContent = String(students);
      $('#parentsRatio').textContent = fmtPct(pRatio);
      $('#studentsRatio').textContent = fmtPct(sRatio);
      $('#usersNew7').textContent = String(metrics.metrics.new7||0);
      $('#usersGrowth').textContent = '+â€”';
      $('#usersNewTrend').textContent = '+â€”';

      const tbody = $('#usersTable tbody');
      tbody.innerHTML = '';
      
      const users = listRes.users || [];
      const totalCount = listRes.total || 0;
      const totalPages = Math.ceil(totalCount / pageSize) || 1;
      
      $('#currPage').textContent = currentPage;
      $('#totalPages').textContent = totalPages;
      $('#prevPage').disabled = currentPage <= 1;
      $('#nextPage').disabled = currentPage >= totalPages;

      users.forEach(u=>{
        const status = u.status || 'lost';
        const statusMap = { active: 'æ´»è·ƒ', idle: 'é—²ç½®', lost: 'æµå¤±' };
        const statusClass = { active: 'active', idle: 'idle', lost: 'lost' };
        
        const tr = document.createElement('tr');
        tr.innerHTML = `<td class="name-cell"><span class="name-text" onclick="showUserDetail(${escapeHtml(JSON.stringify(u))})">${u.full_name||''}</span><button class="btn btn-danger btn-sm btn-delete" data-id="${u.id}"><i class="fas fa-trash"></i> åˆ é™¤</button></td><td>${u.email||''}</td><td>${u.role==='parent'?'å®¶é•¿':'å­¦ç”Ÿ'}</td><td>${(u.created_at||'').slice(0,10)}</td><td><span class="status ${statusClass[status]||'lost'}">${statusMap[status]||'æµå¤±'}</span></td>`;
        const btn = tr.querySelector('.btn-delete');
        btn.addEventListener('click', async ()=>{
          const name = u.full_name || u.email || u.id;
          if (!confirm(`ç¡®è®¤åˆ é™¤ç”¨æˆ·ã€Œ${name}ã€ï¼Ÿæ­¤æ“ä½œä¸å¯æ¢å¤`)) return;
          try {
            await apiPost('/users/delete', { id: u.id });
            showToast('åˆ é™¤æˆåŠŸ');
            await renderUsers();
          } catch (e) {
            console.error(e);
            showToast('åˆ é™¤å¤±è´¥');
          }
        });
        tbody.appendChild(tr);
      });

      const roleCtx = getOrCreateChart('chartUsersRole', 'doughnut');
      roleCtx.data = { labels: ['å®¶é•¿','å­¦ç”Ÿ'], datasets: [{ data: [parents, students], backgroundColor: ['#7c3aed','#0ea5e9'] }] };
      roleCtx.update();

      const labels = Array.from({length:30}, (_,i)=> daysAgo(29-i));
      const trendCtx = getOrCreateChart('chartUsersTrend', 'line');
      trendCtx.data = { labels, datasets: [{ label: 'æ–°å¢ç”¨æˆ·', data: metrics.metrics.registrationTrend || Array.from({length:30}, ()=> 0), borderColor: '#2b6ef2', backgroundColor: 'rgba(43,110,242,0.15)', fill: true, tension: 0.35 }] };
      trendCtx.update();
    }

    

    async function renderBehavior() {
      const role = roleFilter.value;
      const res = await apiGet(`/metrics/behavior?role=${encodeURIComponent(role)}`);
      const m = res.metrics;
      $('#dau').textContent = String(m.dau||0);
      $('#wau').textContent = String(m.wau||0);
      $('#mau').textContent = String(m.mau||0);
      $('#avgSession').textContent = `${m.avgSessionMin||0}m`;
      $('#retention').textContent = fmtPct(m.retentionD1||0);
      $('#sessions30').textContent = String(m.sessions30||0);
      $('#highEngagement').textContent = String(m.userEngagement?.high||0);
      $('#mediumEngagement').textContent = String(m.userEngagement?.medium||0);
      $('#dauTrend').textContent = '+â€”';
      $('#wauTrend').textContent = '+â€”';
      $('#mauTrend').textContent = '+â€”';
      $('#avgSessionTrend').textContent = '+â€”';
      $('#retentionTrend').textContent = '+â€”';
      $('#sessions30Trend').textContent = '+â€”';
      $('#highEngagementTrend').textContent = '+â€”';
      $('#mediumEngagementTrend').textContent = '+â€”';
      
      // è®¡ç®—å¹¶æ˜¾ç¤º30å¤©ä¼šè¯æ•°çš„æ±‡æ€»ç»Ÿè®¡
      const sessions30Total = m.sessions30 ? m.sessions30.reduce((sum, val) => sum + val, 0) : 0;
      const sessions30Avg = m.sessions30 ? (sessions30Total / m.sessions30.length).toFixed(1) : 0;
      const sessions30Max = m.sessions30 ? Math.max(...m.sessions30) : 0;
      const activeDays = m.sessions30 ? m.sessions30.filter(val => val > 0).length : 0;
      
      $('#sessions30').textContent = sessions30Total;
      $('#sessions30').parentElement.querySelector('.stat-title').textContent = '30å¤©æ€»ä¼šè¯æ•°';
      $('#sessions30Trend').textContent = `æ—¥å‡: ${sessions30Avg}`;

      const labels = Array.from({length:30}, (_,i)=> daysAgo(29-i));
      const activeCtx = getOrCreateChart('chartActive','line');
      activeCtx.data = { 
        labels, 
        datasets: [{ 
          label: 'æ—¥æ´»è·ƒç”¨æˆ·æ•°', 
          data: (m.active30||[]), 
          borderColor: '#10b981', 
          backgroundColor: 'rgba(16,185,129,0.15)', 
          fill: true, 
          tension: 0.35 
        }] 
      };
      activeCtx.options = {
        plugins: {
          tooltip: {
            callbacks: {
              label: function(context) {
                return `æ—¥æœŸ: ${context.label}, æ´»è·ƒç”¨æˆ·: ${context.raw}äºº`;
              }
            }
          }
        },
        scales: {
          y: {
            title: {
              display: true,
              text: 'ç”¨æˆ·æ•°é‡'
            }
          },
          x: {
            title: {
              display: true,
              text: 'æ—¥æœŸ'
            }
          }
        }
      };
      activeCtx.update();

      const feat = m.featureUsage || { labels: [], values: [] };
      const featCtx = getOrCreateChart('chartFeatureUsage','bar');
      featCtx.data = { labels: feat.labels, datasets: [{ label: 'æ•°é‡', data: feat.values, backgroundColor: ['#2b6ef2','#0ea5e9','#7c3aed','#f59e0b','#10b981'] }] };
      featCtx.options = { scales: { y: { beginAtZero: true } } };
      featCtx.update();

      // æ¸²æŸ“åŠŸèƒ½ä½¿ç”¨è¶‹åŠ¿å›¾è¡¨
      const featureTrends = m.featureTrends || {};
      const trendLabels = Array.from({length:30}, (_,i)=> daysAgo(29-i));
      const trendCtx = getOrCreateChart('chartFeatureTrends','line');
      const trendDatasets = [];
      const colors = ['#2b6ef2', '#0ea5e9', '#7c3aed', '#f59e0b', '#10b981'];
      let colorIndex = 0;
      
      for (const [feature, data] of Object.entries(featureTrends)) {
        trendDatasets.push({
          label: feature,
          data: data,
          borderColor: colors[colorIndex % colors.length],
          backgroundColor: `rgba(${parseInt(colors[colorIndex % colors.length].slice(1, 3), 16)}, ${parseInt(colors[colorIndex % colors.length].slice(3, 5), 16)}, ${parseInt(colors[colorIndex % colors.length].slice(5, 7), 16)}, 0.15)`,
          fill: true,
          tension: 0.35
        });
        colorIndex++;
      }
      trendCtx.data = { labels: trendLabels, datasets: trendDatasets };
      trendCtx.update();

      // æ¸²æŸ“ç”¨æˆ·æ´»è·ƒåº¦åˆ†å¸ƒå›¾è¡¨
      const userEngagement = m.userEngagement || { high: 0, medium: 0, low: 0, inactive: 0 };
      const engagementCtx = getOrCreateChart('chartUserEngagement','doughnut');
      engagementCtx.data = {
        labels: ['é«˜æ´»è·ƒ', 'ä¸­æ´»è·ƒ', 'ä½æ´»è·ƒ', 'ä¸æ´»è·ƒ'],
        datasets: [{
          data: [userEngagement.high, userEngagement.medium, userEngagement.low, userEngagement.inactive],
          backgroundColor: ['#10b981', '#0ea5e9', '#f59e0b', '#6b7280']
        }]
      };
      engagementCtx.update();

      // æ¸²æŸ“ä¼šè¯æ·±åº¦åˆ†æå›¾è¡¨
      const sessionDepth = m.sessionDepth || {
        durationDistribution: { '0-5åˆ†é’Ÿ': 0, '5-15åˆ†é’Ÿ': 0, '15-30åˆ†é’Ÿ': 0, '30-60åˆ†é’Ÿ': 0, '60+åˆ†é’Ÿ': 0 },
        timeOfDayDistribution: { 'å‡Œæ™¨ (0-6ç‚¹)': 0, 'ä¸Šåˆ (6-12ç‚¹)': 0, 'ä¸‹åˆ (12-18ç‚¹)': 0, 'æ™šä¸Š (18-24ç‚¹)': 0 },
        sessionIntensity: { 'çŸ­æ—¶é«˜é¢‘': 0, 'é•¿æ—¶ä½é¢‘': 0, 'å‡è¡¡ä½¿ç”¨': 0, 'æµ…åº¦ä½¿ç”¨': 0 },
        avgSessionsPerDay: 0,
        maxConsecutiveDays: 0
      };

      // ä¼šè¯æ—¶é•¿åˆ†å¸ƒå›¾è¡¨
      const durationCtx = getOrCreateChart('chartSessionDuration','bar');
      durationCtx.data = {
        labels: Object.keys(sessionDepth.durationDistribution),
        datasets: [{
          label: 'ä¼šè¯æ•°é‡',
          data: Object.values(sessionDepth.durationDistribution),
          backgroundColor: ['#2b6ef2', '#0ea5e9', '#7c3aed', '#f59e0b', '#10b981']
        }]
      };
      durationCtx.options = { scales: { y: { beginAtZero: true } } };
      durationCtx.update();

      // ä½¿ç”¨æ—¶æ®µåˆ†å¸ƒå›¾è¡¨
      const timeOfDayCtx = getOrCreateChart('chartTimeOfDay','doughnut');
      timeOfDayCtx.data = {
        labels: Object.keys(sessionDepth.timeOfDayDistribution),
        datasets: [{
          data: Object.values(sessionDepth.timeOfDayDistribution),
          backgroundColor: ['#2b6ef2', '#0ea5e9', '#7c3aed', '#f59e0b']
        }]
      };
      timeOfDayCtx.update();

      // ä¼šè¯å¼ºåº¦åˆ†å¸ƒå›¾è¡¨
      const intensityCtx = getOrCreateChart('chartSessionIntensity','doughnut');
      intensityCtx.data = {
        labels: Object.keys(sessionDepth.sessionIntensity),
        datasets: [{
          data: Object.values(sessionDepth.sessionIntensity),
          backgroundColor: ['#10b981', '#0ea5e9', '#f59e0b', '#6b7280']
        }]
      };
      intensityCtx.update();

      // æ›´æ–°ç»Ÿè®¡æ•°å­—
      $('#avgSessionsPerDay').textContent = sessionDepth.avgSessionsPerDay;
      $('#maxConsecutiveDays').textContent = sessionDepth.maxConsecutiveDays;
      $('#totalSessions').textContent = m.sessions30 ? m.sessions30.reduce((sum, val) => sum + val, 0) : 0;
      $('#shortHighIntensity').textContent = sessionDepth.sessionIntensity['çŸ­æ—¶é«˜é¢‘'] || 0;
      $('#longLowIntensity').textContent = sessionDepth.sessionIntensity['é•¿æ—¶ä½é¢‘'] || 0;
      $('#balancedIntensity').textContent = sessionDepth.sessionIntensity['å‡è¡¡ä½¿ç”¨'] || 0;
      $('#lightIntensity').textContent = sessionDepth.sessionIntensity['æµ…åº¦ä½¿ç”¨'] || 0;
      
      // åŠ è½½bannerçŠ¶æ€
      await loadBannerStatus();
    }
    
    async function loadBannerStatus() {
      try {
        const res = await apiGet('/banner/status');
        const isVisible = res.visible !== false; // é»˜è®¤ä¸ºtrue
        updateBannerStatusUI(isVisible);
      } catch (e) {
        console.error('Failed to load banner status:', e);
        $('#bannerStatus').textContent = 'åŠ è½½å¤±è´¥';
        $('#bannerStatus').style.color = 'var(--error)';
      }
      
      // åŠ è½½æ–°çš„ banner é…ç½®
      await loadBannerConfig();
    }
    
    async function toggleBannerVisibility() {
      try {
        const res = await apiGet('/banner/status');
        const currentVisible = res.visible !== false;
        const newVisible = !currentVisible;
        
        const headers = { 'X-Admin-Password': PASSWORD, 'Content-Type': 'application/json' };
        const response = await fetch(`${API_BASE}/banner/status`, {
          method: 'POST',
          headers,
          body: JSON.stringify({ visible: newVisible })
        });
        
        if (!response.ok) throw new Error('API request failed');
        
        updateBannerStatusUI(newVisible);
        showToast(newVisible ? 'Banner å·²æ˜¾ç¤º' : 'Banner å·²éšè—');
        
      } catch (e) {
        console.error('Failed to toggle banner:', e);
        showToast('Banner çŠ¶æ€åˆ‡æ¢å¤±è´¥');
      }
    }
    
    function updateBannerStatusUI(isVisible) {
      $('#bannerStatus').textContent = isVisible ? 'æ˜¾ç¤ºä¸­' : 'å·²éšè—';
      $('#bannerStatus').style.color = isVisible ? 'var(--success)' : 'var(--error)';
      $('#toggleBanner').innerHTML = isVisible ? 
        '<i class="fas fa-eye-slash"></i> éšè— Banner' : 
        '<i class="fas fa-eye"></i> æ˜¾ç¤º Banner';
    }

    // Home Page Banner é…ç½®åŠŸèƒ½
    async function loadBannerConfig() {
      try {
        const config = await apiGet('/banner/config');
        $('#bannerTitle').value = config.title || 'Stop Studying Hard. Start Studying Smart.';
        $('#bannerUrl').value = config.url || 'https://studyflow.club/app.html';
        $('#bannerVisibility').value = config.visible !== false ? 'true' : 'false';
        $('#reminderTime').value = config.reminderTime || '';
        $('#enableReminder').checked = config.reminderEnabled || false;
        
        // æ›´æ–°é¢„è§ˆ
        updateBannerPreview();
      } catch (error) {
        console.error('Failed to load banner config:', error);
        showToast('åŠ è½½ banner é…ç½®å¤±è´¥');
      }
    }

    async function saveBannerConfig() {
      try {
        const config = {
          title: $('#bannerTitle').value,
          url: $('#bannerUrl').value,
          visible: $('#bannerVisibility').value === 'true',
          reminderTime: $('#reminderTime').value,
          reminderEnabled: $('#enableReminder').checked
        };

        const headers = { 
          'X-Admin-Password': PASSWORD, 
          'Content-Type': 'application/json' 
        };
        
        const response = await fetch(`${API_BASE}/banner/config`, {
          method: 'POST',
          headers,
          body: JSON.stringify(config)
        });

        if (!response.ok) throw new Error('ä¿å­˜å¤±è´¥');

        showToast('Banner é…ç½®å·²ä¿å­˜');
        updateBannerPreview();
      } catch (error) {
        console.error('Failed to save banner config:', error);
        showToast('ä¿å­˜ banner é…ç½®å¤±è´¥');
      }
    }

    function updateBannerPreview() {
      const title = $('#bannerTitle').value || 'Stop Studying Hard. Start Studying Smart.';
      const url = $('#bannerUrl').value || 'https://studyflow.club/app.html';
      const preview = $('#bannerPreview');
      
      preview.querySelector('.banner-title').textContent = title;
      preview.querySelector('.banner-subtitle').textContent = `ç‚¹å‡»è·³è½¬åˆ° ${new URL(url).hostname}`;
    }

    // ç»‘å®š banner è¾“å…¥äº‹ä»¶
    function bindBannerEvents() {
      $('#bannerTitle').addEventListener('input', updateBannerPreview);
      $('#bannerUrl').addEventListener('input', updateBannerPreview);
      $('#saveBannerConfig').addEventListener('click', saveBannerConfig);
    }

    async function renderFeedback() {
      try {
        const all = (await apiGet('/feedback')).items || [];
        
        // åº”ç”¨ç­›é€‰æ¡ä»¶
        const roleFilterValue = $('#roleFilterFeedback').value;
        const ratingFilterValue = $('#ratingFilter').value;
        const timeRangeValue = $('#timeRangeFilter').value;
        
        let items = all;
        
        // è§’è‰²ç­›é€‰
        if (roleFilterValue !== 'all') {
          items = items.filter(i => i.role === roleFilterValue);
        }
        
        // è¯„åˆ†ç­›é€‰
        if (ratingFilterValue !== 'all') {
          items = items.filter(i => Number(i.rating) === Number(ratingFilterValue));
        }
        
        // æ—¶é—´ç­›é€‰
        if (timeRangeValue !== 'all') {
          const now = new Date();
          let startDate;
          
          switch (timeRangeValue) {
            case '7d':
              startDate = new Date(now.getTime() - 7 * 24 * 60 * 60 * 1000);
              break;
            case '30d':
              startDate = new Date(now.getTime() - 30 * 24 * 60 * 60 * 1000);
              break;
            case '90d':
              startDate = new Date(now.getTime() - 90 * 24 * 60 * 60 * 1000);
              break;
            case 'custom':
              const start = $('#startDate').value;
              const end = $('#endDate').value;
              if (start && end) {
                items = items.filter(i => {
                  const itemDate = new Date(i.created_at);
                  return itemDate >= new Date(start) && itemDate <= new Date(end);
                });
              }
              break;
          }
          
          if (timeRangeValue !== 'custom') {
            items = items.filter(i => new Date(i.created_at) >= startDate);
          }
        }
        
        const count = items.length;
        const uniqueUsers = new Set(items.map(i => i.user_id || i.user_email)).size;
        const avg = items.reduce((s, i) => s + Number(i.rating || 0), 0) / (count || 1);
        
        // æ›´æ–°ç»Ÿè®¡å¡ç‰‡
        $('#avgRating').textContent = avg.toFixed(1);
        $('#feedbackCount').textContent = String(count);
        $('#uniqueUsers').textContent = String(uniqueUsers);
        
        const positive = items.filter(i => Number(i.rating) >= 4).length / (count || 1) * 100;
        $('#positiveRatio').textContent = fmtPct(positive);
        
        // åˆ†ç±»ç»Ÿè®¡: issues vs feature requests
        const issuesCount = items.filter(i => {
          // æ£€æŸ¥issue_detailså­—æ®µæ˜¯å¦æœ‰å†…å®¹
          if (i.issue_details && i.issue_details.trim().length > 0) {
            return true;
          }
          // åå¤‡æ£€æŸ¥ï¼šæ£€æŸ¥æ–‡æœ¬å†…å®¹ä¸­çš„å…³é”®è¯
          const text = (i.text || '').toLowerCase();
          return text.includes('issue') || 
                 text.includes('problem') ||
                 text.includes('bug') ||
                 text.includes('error') ||
                 text.includes('æ— æ³•') ||
                 text.includes('é—®é¢˜') ||
                 text.includes('å´©æºƒ') ||
                 text.includes('é—ªé€€');
        }).length;
        
        const featureRequestsCount = items.filter(i => {
          // æ£€æŸ¥feature_requestså­—æ®µæ˜¯å¦æœ‰å†…å®¹
          if (i.feature_requests && i.feature_requests.trim().length > 0) {
            return true;
          }
          // åå¤‡æ£€æŸ¥ï¼šæ£€æŸ¥æ–‡æœ¬å†…å®¹ä¸­çš„å…³é”®è¯
          const text = (i.text || '').toLowerCase();
          return text.includes('feature') || 
                 text.includes('request') ||
                 text.includes('å»ºè®®') ||
                 text.includes('å¸Œæœ›') ||
                 text.includes('å¢åŠ ') ||
                 text.includes('æ·»åŠ ') ||
                 text.includes('æ”¹è¿›') ||
                 text.includes('ä¼˜åŒ–');
        }).length;
        
        // æ›´æ–°åˆ†ç±»ç»Ÿè®¡æ˜¾ç¤º
        $('#issuesCount').textContent = String(issuesCount);
        $('#featureRequestsCount').textContent = String(featureRequestsCount);
        $('#issuesRatio').textContent = fmtPct((issuesCount / Math.max(count, 1)) * 100);
        $('#featuresRatio').textContent = fmtPct((featureRequestsCount / Math.max(count, 1)) * 100);
        
        const promoters = items.filter(i => Number(i.rating) >= 4).length / count * 100 || 0;
        const detractors = items.filter(i => Number(i.rating) <= 2).length / count * 100 || 0;
        const nps = Math.round(promoters - detractors);
        $('#nps').textContent = String(nps);
        
        // æ›´æ–°è¶‹åŠ¿æŒ‡ç¤ºå™¨
        updateTrendIndicators();
        
        // æ›´æ–°ç»“æœè®¡æ•°
        $('#feedbackResultCount').textContent = `æ˜¾ç¤º ${count} æ¡ç»“æœ`;
        
        // ç»˜åˆ¶è¯„åˆ†åˆ†å¸ƒå›¾è¡¨
        const dist = [1, 2, 3, 4, 5].map(r => items.filter(i => Number(i.rating) === r).length);
        const ratingCtx = getOrCreateChart('chartRatings', 'bar');
        ratingCtx.data = {
          labels: ['1æ˜Ÿ', '2æ˜Ÿ', '3æ˜Ÿ', '4æ˜Ÿ', '5æ˜Ÿ'],
          datasets: [{
            label: 'æ•°é‡',
            data: dist,
            backgroundColor: ['#ef4444', '#f59e0b', '#eab308', '#22c55e', '#10b981']
          }]
        };
        ratingCtx.update();
        
        // ç»˜åˆ¶è§’è‰²åˆ†å¸ƒå›¾è¡¨
        const roleCounts = {};
        items.forEach(item => {
          const role = item.role || 'unknown';
          roleCounts[role] = (roleCounts[role] || 0) + 1;
        });
        
        const roleCtx = getOrCreateChart('chartRoles', 'doughnut');
        roleCtx.data = {
          labels: Object.keys(roleCounts).map(r => r === 'parent' ? 'å®¶é•¿' : 'å­¦ç”Ÿ'),
          datasets: [{
            data: Object.values(roleCounts),
            backgroundColor: ['#3B82F6', '#8B5CF6']
          }]
        };
        roleCtx.update();
        
        // å…³é”®è¯åˆ†æ
        const keywordMap = {};
        const commonKeywords = ['ä½œä¸š', 'æé†’', 'å®¶é•¿', 'è¯­éŸ³', 'é€Ÿåº¦', 'ç•Œé¢', 'åŠŸèƒ½', 'ä½¿ç”¨', 'é—®é¢˜', 'å»ºè®®'];
        
        items.forEach(item => {
          const text = (item.text || '').toLowerCase();
          commonKeywords.forEach(keyword => {
            if (text.includes(keyword.toLowerCase())) {
              keywordMap[keyword] = (keywordMap[keyword] || 0) + 1;
            }
          });
        });
        
        const sortedKeywords = Object.entries(keywordMap)
          .sort((a, b) => b[1] - a[1])
          .slice(0, 10);
        
        const kList = $('#keywordsList');
        kList.innerHTML = '';
        
        sortedKeywords.forEach(([keyword, count], index) => {
          const div = document.createElement('div');
          div.className = 'keyword-item';
          div.innerHTML = `
            <span>${index + 1}. ${keyword}</span>
            <span class="keyword-count">${count}</span>
          `;
          kList.appendChild(div);
        });
        
        // æ¸²æŸ“åé¦ˆåˆ—è¡¨
        renderFeedbackList(items);
        
      } catch (error) {
        console.error('åŠ è½½åé¦ˆæ•°æ®å¤±è´¥:', error);
        showToast('åŠ è½½åé¦ˆæ•°æ®å¤±è´¥');
      }
    }
    
    // æ£€æµ‹åé¦ˆåˆ†ç±»
    function detectFeedbackCategory(feedback) {
      const text = (feedback.text || '').toLowerCase();
      
      if (text.includes('issue') || 
          text.includes('problem') ||
          text.includes('bug') ||
          text.includes('error') ||
          text.includes('æ— æ³•') ||
          text.includes('é—®é¢˜') ||
          text.includes('å´©æºƒ') ||
          text.includes('é—ªé€€')) {
        return 'issue';
      }
      
      if (text.includes('feature') || 
          text.includes('request') ||
          text.includes('å»ºè®®') ||
          text.includes('å¸Œæœ›') ||
          text.includes('å¢åŠ ') ||
          text.includes('æ·»åŠ ') ||
          text.includes('æ”¹è¿›') ||
          text.includes('ä¼˜åŒ–')) {
        return 'feature';
      }
      
      return null;
    }
    
    // è·å–åˆ†ç±»æ ‡ç­¾HTML
    function getCategoryBadge(category) {
      if (category === 'issue') {
        return '<span class="category-badge category-issue">é—®é¢˜åé¦ˆ</span>';
      } else if (category === 'feature') {
        return '<span class="category-badge category-feature">åŠŸèƒ½å»ºè®®</span>';
      }
      return '';
    }

    // åˆ é™¤ç”¨æˆ·çš„æ‰€æœ‰è°ƒæŸ¥æ•°æ®
    async function deleteUserSurveys(userId, userEmail, feedbackId) {
      const userName = userEmail || userId || 'è¯¥ç”¨æˆ·';
      if (!confirm(`ç¡®å®šè¦åˆ é™¤ ${userName} çš„æ‰€æœ‰è°ƒæŸ¥æ•°æ®å—ï¼Ÿæ­¤æ“ä½œæ— æ³•æ’¤é”€ã€‚`)) {
        return;
      }

      // è°ƒè¯•ä¿¡æ¯ï¼šæ£€æŸ¥ä¼ é€’çš„å‚æ•°
      console.log('åˆ é™¤å‚æ•°:', { userId, userEmail, feedbackId });

      try {
        const result = await apiPost('/feedback/delete', { 
          user_id: userId,
          user_email: userEmail,
          feedback_id: feedbackId
        });
        
        showToast(`å·²æˆåŠŸåˆ é™¤ ${userName} çš„è°ƒæŸ¥æ•°æ®`);
        
        // é‡æ–°åŠ è½½åé¦ˆæ•°æ®
        setTimeout(() => loadFeedback(), 1000);
      } catch (error) {
        console.error('åˆ é™¤å¤±è´¥:', error);
        
        // å¦‚æœç«¯ç‚¹ä¸å­˜åœ¨æˆ–å…¶ä»–é”™è¯¯ï¼Œæä¾›å‹å¥½çš„é”™è¯¯ä¿¡æ¯
        if (error.message.includes('404') || error.message.includes('Not Found')) {
          showToast('åˆ é™¤åŠŸèƒ½æš‚ä¸å¯ç”¨ï¼Œè¯·è”ç³»ç®¡ç†å‘˜');
        } else {
          showToast(`åˆ é™¤å¤±è´¥: ${error.message}`);
        }
      }
    }
    
    function renderFeedbackList(items) {
      const tableView = $('#feedbackTableView').style.display !== 'none';
      
      if (tableView) {
        // è¡¨æ ¼è§†å›¾
        const tbody = $('#feedbackTable tbody');
        tbody.innerHTML = '';
        
        items.slice(0, 100).forEach(f => {
          const tr = document.createElement('tr');
          const at = (f.created_at || '').slice(0, 10);
          const userName = f.user_name || f.user_email || 'æœªçŸ¥ç”¨æˆ·';
          const category = detectFeedbackCategory(f);
          const categoryBadge = getCategoryBadge(category);
          
          tr.innerHTML = `
            <td>${at}</td>
            <td>
              <div class="feedback-user">
                <div class="feedback-avatar">${userName.charAt(0).toUpperCase()}</div>
                <div class="feedback-info">
                  <div class="feedback-name">${escapeHtml(userName)}</div>
                  <div class="feedback-role">${f.user_email || 'æ— é‚®ç®±'}</div>
                </div>
              </div>
            </td>
            <td>${f.role === 'parent' ? 'å®¶é•¿' : 'å­¦ç”Ÿ'}</td>
            <td>
              <div class="feedback-rating">
                ${'â˜…'.repeat(f.rating)}${'â˜†'.repeat(5 - f.rating)}
                <span style="font-size:12px;color:#666;margin-left:4px;">(${f.rating})</span>
              </div>
            </td>
            <td>
              ${categoryBadge}
              ${escapeHtml(f.text || '')}
              ${f.issue_details ? `<div style="margin-top:4px;padding:4px;background:#fff5f5;border-radius:2px;font-size:11px;color:#7f1d1d;">
                <strong>é—®é¢˜:</strong> ${escapeHtml(f.issue_details.substring(0, 50))}${f.issue_details.length > 50 ? '...' : ''}
              </div>` : ''}
              ${f.feature_requests ? `<div style="margin-top:4px;padding:4px;background:#f0f9ff;border-radius:2px;font-size:11px;color:#0c4a6e;">
                <strong>å»ºè®®:</strong> ${escapeHtml(f.feature_requests.substring(0, 50))}${f.feature_requests.length > 50 ? '...' : ''}
              </div>` : ''}
            </td>
            <td>
              <button class="btn btn-sm" onclick="showFeedbackDetail(${JSON.stringify(f).replace(/"/g, '&quot;')})">è¯¦æƒ…</button>
              <button class="btn btn-sm btn-danger" onclick="deleteUserSurveys('${f.user_id || ''}', '${f.user_email || ''}', '${f.id}')" style="margin-left:4px;">åˆ é™¤</button>
            </td>
          `;
          tbody.appendChild(tr);
        });
      } else {
        // å¡ç‰‡è§†å›¾
        const container = $('#feedbackCardsContainer');
        container.innerHTML = '';
        
        items.slice(0, 50).forEach(f => {
          const card = document.createElement('div');
          card.className = 'feedback-card';
          const userName = f.user_name || f.user_email || 'æœªçŸ¥ç”¨æˆ·';
          const at = (f.created_at || '').slice(0, 10);
          const category = detectFeedbackCategory(f);
          const categoryBadge = getCategoryBadge(category);
          
          card.innerHTML = `
            <div class="feedback-header">
              <div class="feedback-user">
                <div class="feedback-avatar">${userName.charAt(0).toUpperCase()}</div>
                <div class="feedback-info">
                  <div class="feedback-name">${escapeHtml(userName)}</div>
                  <div class="feedback-role">${f.role === 'parent' ? 'å®¶é•¿' : 'å­¦ç”Ÿ'} â€¢ ${f.user_email || 'æ— é‚®ç®±'}</div>
                </div>
              </div>
              <div class="feedback-rating">
                ${'â˜…'.repeat(f.rating)}${'â˜†'.repeat(5 - f.rating)}
              </div>
            </div>
            <div class="feedback-content">
              ${categoryBadge}
              ${escapeHtml(f.text || '')}
            </div>
            ${f.issue_details ? `<div class="feedback-issue" style="margin-top:8px;padding:8px;background:#fff5f5;border-radius:4px;border-left:3px solid #ef4444;">
              <div style="font-size:12px;color:#ef4444;font-weight:500;margin-bottom:4px;">é‡åˆ°çš„é—®é¢˜:</div>
              <div style="font-size:13px;color:#7f1d1d;">${escapeHtml(f.issue_details)}</div>
            </div>` : ''}
            ${f.feature_requests ? `<div class="feedback-feature" style="margin-top:8px;padding:8px;background:#f0f9ff;border-radius:4px;border-left:3px solid #0ea5e9;">
              <div style="font-size:12px;color:#0ea5e9;font-weight:500;margin-bottom:4px;">åŠŸèƒ½å»ºè®®:</div>
              <div style="font-size:13px;color:#0c4a6e;">${escapeHtml(f.feature_requests)}</div>
            </div>` : ''}
            <div class="feedback-time">
              ${at}
            </div>
            <div class="feedback-actions">
              <button class="btn btn-sm btn-danger" onclick="deleteUserSurveys('${f.user_id || ''}', '${f.user_email || ''}', '${f.id}')">åˆ é™¤ç”¨æˆ·æ•°æ®</button>
            </div>
          `;
          container.appendChild(card);
        });
      }
    }
    
    function showFeedbackDetail(feedback) {
      // æ˜¾ç¤ºåé¦ˆè¯¦æƒ…çš„æ¨¡æ€æ¡†
      let detailText = `åé¦ˆè¯¦æƒ…:\nç”¨æˆ·: ${feedback.user_name || feedback.user_email}\nè¯„åˆ†: ${feedback.rating}æ˜Ÿ`;
      
      if (feedback.additional_comments) {
        detailText += `\né™„åŠ è¯„è®º: ${feedback.additional_comments}`;
      }
      if (feedback.issue_details) {
        detailText += `\né‡åˆ°çš„é—®é¢˜: ${feedback.issue_details}`;
      }
      if (feedback.feature_requests) {
        detailText += `\nåŠŸèƒ½å»ºè®®: ${feedback.feature_requests}`;
      }
      
      alert(detailText);
    }
    
    function updateTrendIndicators() {
      // è¿™é‡Œå¯ä»¥æ·»åŠ è¶‹åŠ¿è®¡ç®—é€»è¾‘
      $('#avgRatingTrend').textContent = '+â€”';
      $('#feedbackTrend').textContent = '+â€”';
      $('#usersTrend').textContent = '+â€”';
      $('#positiveTrend').textContent = '+â€”';
      $('#npsTrend').textContent = '+â€”';
    }

    async function renderMaintenance() {
      const res = await apiGet('/maintenance/preview');
      const m = res.metrics;
      $('#orphans').textContent = String(m.orphans||0);
      $('#duplicates').textContent = String(m.duplicates||0);
      $('#archives').textContent = String(m.archives||0);
      $('#orphansTrend').textContent = 'â€”';
      $('#duplicatesTrend').textContent = 'â€”';
      $('#archivesTrend').textContent = 'â€”';
      if (!$('#dbLogs').dataset.init) {
        $('#dbLogs').dataset.init = '1';
        $('#dbLogs').innerHTML = '';
        logDb('å‡†å¤‡å°±ç»ª');
      }
    }

    async function runMaintenance(action) {
      const map = { 
        backup: 'å¤‡ä»½æ•°æ®åº“',
        cleanup: 'æ¸…ç†æ®‹ç•™æ•°æ®', 
        dedupe: 'å»é‡', 
        reindex: 'é‡å»ºç´¢å¼•', 
        archive: 'å½’æ¡£æ—§è®°å½•', 
        vacuum: 'å‹ç¼©ç©ºé—´' 
      };
      
      // å±é™©æ“ä½œéœ€è¦ç¡®è®¤
      const dangerousActions = ['cleanup', 'dedupe', 'archive'];
      if (dangerousActions.includes(action)) {
        const confirmed = confirm(`âš ï¸  è­¦å‘Šï¼šæ­¤æ“ä½œå°†${map[action]}ï¼Œå¯èƒ½ä¼šåˆ é™¤æ•°æ®ã€‚\n\nè¯·ç¡®è®¤å·²å¤‡ä»½æ•°æ®åº“å¹¶äº†è§£æ“ä½œé£é™©ã€‚\n\nç¡®å®šè¦ç»§ç»­å—ï¼Ÿ`);
        if (!confirmed) {
          logDb(`${map[action]}å·²å–æ¶ˆ`);
          showToast('æ“ä½œå·²å–æ¶ˆ');
          return;
        }
      }
      
      logDb(`${map[action]}å¼€å§‹`);
      showToast(`${map[action]}æ‰§è¡Œä¸­`);
      const btns = $$('#tab-db [data-action]');
      btns.forEach(b=> b.disabled = true);
      
      try {
        const headers = { 'X-Admin-Password': PASSWORD };
        let path = '';
        
        if (action === 'backup') {
          // å¤‡ä»½æ•°æ®åº“ - ä¸‹è½½JSONæ–‡ä»¶
          await backupDatabase();
        } else if (action === 'cleanup' || action === 'dedupe' || action === 'reindex' || action === 'archive' || action === 'vacuum') {
          path = `/maintenance/${action}`;
          const res = await fetch(`${API_BASE}${path}`, { method: 'POST', headers });
          const json = await res.json();
          if (!json.ok) throw new Error(json.error||'API error');
        }
        
        logDb(`${map[action]}å®Œæˆ`);
        if (action !== 'backup') {
          await renderMaintenance();
        }
        showToast(`${map[action]}å®Œæˆ`);
      } catch (e) {
        logDb(`${map[action]}å¤±è´¥: ${e.message}`);
        showToast(`${map[action]}å¤±è´¥`);
      } finally {
        btns.forEach(b=> b.disabled = false);
      }
    }
    
    async function backupDatabase() {
      try {
        logDb('å¼€å§‹å¤‡ä»½æ•°æ®åº“...');
        showToast('æ­£åœ¨å¤‡ä»½æ•°æ®åº“ï¼Œè¯·ç¨å€™...');
        
        // ä½¿ç”¨æ–°çš„å¤‡ä»½APIç«¯ç‚¹è·å–å®Œæ•´æ•°æ®
        const response = await fetch(`${API_BASE}/backup/data`, {
          headers: { 'X-Admin-Password': PASSWORD }
        });
        
        if (!response.ok) {
          throw new Error(`HTTP ${response.status}: ${await response.text()}`);
        }
        
        const backupData = await response.json();
        
        // åˆ›å»ºä¸‹è½½é“¾æ¥
        const dataStr = JSON.stringify(backupData, null, 2);
        const dataBlob = new Blob([dataStr], { type: 'application/json' });
        const url = URL.createObjectURL(dataBlob);
        const link = document.createElement('a');
        const dateStr = new Date().toISOString().slice(0, 10).replace(/-/g, '');
        
        link.href = url;
        link.download = `studyflow_backup_${dateStr}.json`;
        link.click();
        
        // æ¸…ç†URL
        setTimeout(() => URL.revokeObjectURL(url), 100);
        
        logDb(`æ•°æ®åº“å¤‡ä»½å®Œæˆï¼Œå…± ${backupData.metadata.totalRecords} æ¡è®°å½•`);
        showToast('æ•°æ®åº“å¤‡ä»½å·²ä¸‹è½½');
        
      } catch (error) {
        console.error('å¤‡ä»½å¤±è´¥:', error);
        logDb(`å¤‡ä»½å¤±è´¥: ${error.message}`);
        showToast('å¤‡ä»½å¤±è´¥');
      }
    }

    function logDb(msg) {
      const d = new Date().toISOString().replace('T',' ').slice(0,19);
      const row = document.createElement('div');
      row.textContent = `[${d}] ${msg}`;
      $('#dbLogs').prepend(row);
    }

    // æ•°æ®åº“æ¢å¤åŠŸèƒ½
    function toggleRestorePanel() {
      const panel = $('#restorePanel');
      panel.style.display = panel.style.display === 'none' ? 'block' : 'none';
    }

    function cancelRestore() {
      $('#restorePanel').style.display = 'none';
      $('#restoreFile').value = '';
    }

    async function confirmRestore() {
      const fileInput = $('#restoreFile');
      const file = fileInput.files[0];
      
      if (!file) {
        showToast('è¯·é€‰æ‹©å¤‡ä»½æ–‡ä»¶');
        return;
      }

      // æ ¹æ®é€‰é¡¹ç”Ÿæˆç¡®è®¤æ¶ˆæ¯
      const safeMode = $('#safeMode').checked;
      const dryRun = $('#dryRun').checked;
      
      let confirmMessage = 'âš ï¸  è­¦å‘Šï¼šæ­¤æ“ä½œå°†æ¢å¤æ•°æ®åº“æ•°æ®ã€‚\n\n';
      confirmMessage += 'å®‰å…¨é€‰é¡¹ï¼š';
      confirmMessage += safeMode ? 'âœ… å®‰å…¨æ¨¡å¼ï¼ˆå¿½ç•¥é‡å¤è®°å½•ï¼‰' : 'âŒ å®‰å…¨æ¨¡å¼å·²ç¦ç”¨ï¼ˆå¯èƒ½è¦†ç›–æ•°æ®ï¼‰';
      confirmMessage += dryRun ? ' âœ… å¹²è·‘æ¨¡å¼ï¼ˆåªéªŒè¯ä¸ä¿®æ”¹ï¼‰' : ' âŒ å¹²è·‘æ¨¡å¼å·²ç¦ç”¨ï¼ˆå®é™…ä¿®æ”¹æ•°æ®ï¼‰';
      confirmMessage += '\n\nè¯·ç¡®è®¤å¤‡ä»½æ–‡ä»¶æ­£ç¡®ä¸”äº†è§£æ“ä½œé£é™©ã€‚\n\nç¡®å®šè¦ç»§ç»­å—ï¼Ÿ';
      
      if (!confirm(confirmMessage)) {
        return;
      }

      try {
        logDb('å¼€å§‹æ¢å¤æ•°æ®åº“...');
        showToast('æ­£åœ¨æ¢å¤æ•°æ®åº“ï¼Œè¯·ç¨å€™...');
        
        const fileContent = await readFileAsText(file);
        const backupData = JSON.parse(fileContent);
        
        // éªŒè¯å¤‡ä»½æ–‡ä»¶æ ¼å¼
        if (!backupData.tables || !backupData.timestamp) {
          throw new Error('æ— æ•ˆçš„å¤‡ä»½æ–‡ä»¶æ ¼å¼');
        }
        
        // è·å–å®‰å…¨é€‰é¡¹
        const safeMode = $('#safeMode').checked;
        const dryRun = $('#dryRun').checked;
        
        const response = await fetch(`${API_BASE}/backup/restore`, {
          method: 'POST',
          headers: {
            'Content-Type': 'application/json',
            'X-Admin-Password': PASSWORD
          },
          body: JSON.stringify({ 
            backupData,
            safeMode,
            dryRun
          })
        });
        
        if (!response.ok) {
          const errorText = await response.text();
          throw new Error(`æ¢å¤å¤±è´¥: ${errorText}`);
        }
        
        const result = await response.json();
        
        if (result.success) {
          logDb(`æ•°æ®åº“æ¢å¤å®Œæˆï¼Œå…±æ¢å¤ ${result.totalRestored} æ¡è®°å½•`);
          showToast('æ•°æ®åº“æ¢å¤æˆåŠŸ');
          
          // æ˜¾ç¤ºè¯¦ç»†çš„æ¢å¤ç»“æœ
          for (const [table, tableResult] of Object.entries(result.results)) {
            if (tableResult.success) {
              logDb(`è¡¨ ${table}: æˆåŠŸæ¢å¤ ${tableResult.records} æ¡è®°å½•`);
            } else {
              logDb(`è¡¨ ${table}: æ¢å¤å¤±è´¥ - ${tableResult.error}`);
            }
          }
          
        } else {
          throw new Error(result.error || 'æ¢å¤å¤±è´¥');
        }
        
      } catch (error) {
        console.error('æ¢å¤å¤±è´¥:', error);
        logDb(`æ¢å¤å¤±è´¥: ${error.message}`);
        showToast('æ¢å¤å¤±è´¥');
      } finally {
        $('#restorePanel').style.display = 'none';
        fileInput.value = '';
      }
    }

    function readFileAsText(file) {
      return new Promise((resolve, reject) => {
        const reader = new FileReader();
        reader.onload = e => resolve(e.target.result);
        reader.onerror = e => reject(new Error('æ–‡ä»¶è¯»å–å¤±è´¥'));
        reader.readAsText(file);
      });
    }

    async function renderPayment() {
      const res = await apiGet('/metrics/payment');
      const p = res.metrics || {};
      $('#revenueTotal').textContent = p.unavailable ? 'N/A' : fmtMoney(p.revenueTotal||0);
      $('#paidUsers').textContent = p.unavailable ? 'N/A' : String(p.paidUsers||0);
      $('#conversion').textContent = p.unavailable ? 'N/A' : fmtPct(p.conversion||0);
      $('#mrrGrowth').textContent = p.unavailable ? 'N/A' : fmtPct(p.mrrGrowth||0);
      $('#revenueTrend').textContent = 'â€”';
      $('#paidUsersTrend').textContent = 'â€”';
      $('#conversionTrend').textContent = 'â€”';
      $('#mrrGrowthTrend').textContent = 'â€”';

      const months = Array.from({length:12}, (_,i)=> `${i+1}æœˆ`);
      const revCtx = getOrCreateChart('chartRevenue','bar');
      revCtx.data = { labels: months, datasets: [{ label: 'æ”¶å…¥', data: p.revenueMonthly||[], backgroundColor: '#2b6ef2' }] };
      revCtx.options = { scales: { y: { beginAtZero: true, ticks: { callback: v=> '$'+v } } } };
      revCtx.update();

      const planCtx = getOrCreateChart('chartPlans','doughnut');
      const plans = p.plans || { labels: [], values: [] };
      planCtx.data = { labels: plans.labels, datasets: [{ data: plans.values, backgroundColor: ['#0ea5e9','#10b981','#7c3aed'] }] };
      planCtx.update();
    }

    function getOrCreateChart(id, type) {
      if (charts[id]) return charts[id];
      const ctx = document.getElementById(id).getContext('2d');
      charts[id] = new Chart(ctx, { type, data: {}, options: { plugins: { legend: { labels: { usePointStyle: true } } }, responsive: true, maintainAspectRatio: false, resizeDelay: 100 } });
      return charts[id];
    }

    function exportTableCSV(selector, filename) {
      const rows = $$(selector + ' tr').map(tr => $$("td,th", tr).map(td => '"'+(td.innerText||'').replace(/"/g,'""')+'"').join(','));
      const csv = rows.join('\n');
      const blob = new Blob([csv], { type: 'text/csv;charset=utf-8;' });
      const url = URL.createObjectURL(blob);
      const a = document.createElement('a');
      a.href = url; a.download = filename; a.click();
      URL.revokeObjectURL(url);
    }

    function escapeHtml(s) { return s.replace(/[&<>"]+/g, c => ({'&':'&amp;','<':'&lt;','>':'&gt;','"':'&quot;'}[c])); }

    // ç”¨æˆ·è¯¦æƒ…æ¨¡æ€æ¡†
    function showUserDetail(user) {
      const modal = document.createElement('div');
      modal.className = 'modal';
      modal.innerHTML = `
        <div class="modal-content">
          <div class="modal-header">
            <h3>ç”¨æˆ·è¯¦æƒ…</h3>
            <button class="modal-close">&times;</button>
          </div>
          <div class="modal-body">
            <div class="user-detail-grid">
              <div class="detail-item">
                <label>å§“å:</label>
                <span>${escapeHtml(user.full_name || 'æœªè®¾ç½®')}</span>
              </div>
              <div class="detail-item">
                <label>é‚®ç®±:</label>
                <span>${escapeHtml(user.email || 'æœªè®¾ç½®')}</span>
              </div>
              <div class="detail-item">
                <label>è§’è‰²:</label>
                <span>${user.role === 'parent' ? 'å®¶é•¿' : 'å­¦ç”Ÿ'}</span>
              </div>
              <div class="detail-item">
                <label>æ³¨å†Œæ—¶é—´:</label>
                <span>${user.created_at ? user.created_at.slice(0, 10) : 'æœªçŸ¥'}</span>
              </div>
              <div class="detail-item">
                <label>ç”¨æˆ·ID:</label>
                <span>${user.id || 'æœªçŸ¥'}</span>
              </div>
              <div class="detail-item">
                <label>å¹´é¾„:</label>
                <span>${user.age ? user.age + 'å²' : 'æœªè®¾ç½®'}</span>
              </div>
              <div class="detail-item">
                <label>æ€§åˆ«:</label>
                <span>${user.gender === 'male' ? 'ç”·' : user.gender === 'female' ? 'å¥³' : 'æœªè®¾ç½®'}</span>
              </div>
              <div class="detail-item">
                <label>å¹´çº§:</label>
                <span>${user.grade ? 'Grade ' + user.grade : 'æœªè®¾ç½®'}</span>
              </div>
              <div class="detail-item">
                <label>å­¦æ ¡:</label>
                <span>${escapeHtml(user.school_name || 'æœªè®¾ç½®')}</span>
              </div>
              <div class="detail-item">
                <label>è¯¾ç¨‹:</label>
                <span>${user.selected_courses && user.selected_courses.length > 0 ? user.selected_courses.length + 'é—¨è¯¾ç¨‹' : 'æœªè®¾ç½®'}</span>
              </div>
            </div>
            <div class="modal-footer">
              <button class="btn btn-primary" onclick="closeUserDetail()">å…³é—­</button>
            </div>
          </div>
        </div>
      `;
      
      modal.querySelector('.modal-close').addEventListener('click', closeUserDetail);
      document.body.appendChild(modal);
      setTimeout(() => modal.classList.add('show'), 10);
    }

    function closeUserDetail() {
      const modal = document.querySelector('.modal');
      if (modal) {
        modal.classList.remove('show');
        setTimeout(() => modal.remove(), 300);
      }
    }
  </script>

  <style>
    /* Banner é…ç½®æ¨¡å—æ ·å¼ */
    .banner-config-panel {
      border: 1px solid var(--border);
      border-radius: 16px;
      overflow: hidden;
      box-shadow: 0 4px 20px rgba(0, 0, 0, 0.08);
    }
    
    .banner-config-grid {
      display: grid;
      grid-template-columns: 1fr 1fr;
      gap: 24px;
    }
    
    .banner-config-form {
      display: flex;
      flex-direction: column;
      gap: 16px;
    }
    
    .form-label {
      display: flex;
      align-items: center;
      font-weight: 600;
      color: var(--text-primary);
      margin-bottom: 8px;
      font-size: 14px;
    }
    
    .modern-input {
      border: 2px solid var(--border-light);
      border-radius: 12px;
      padding: 12px 16px;
      font-size: 14px;
      transition: all 0.2s ease;
      background: white;
    }
    
    .modern-input:focus {
      border-color: var(--primary);
      box-shadow: 0 0 0 3px rgba(43, 110, 242, 0.1);
      outline: none;
    }
    
    .modern-select {
      border: 2px solid var(--border-light);
      border-radius: 12px;
      padding: 12px 16px;
      font-size: 14px;
      background: white;
      cursor: pointer;
      transition: all 0.2s ease;
    }
    
    .modern-select:focus {
      border-color: var(--primary);
      box-shadow: 0 0 0 3px rgba(43, 110, 242, 0.1);
      outline: none;
    }
    
    .form-help {
      color: var(--text-muted);
      font-size: 12px;
      margin-top: 6px;
      display: block;
    }
    
    .checkbox-group {
      margin-top: 8px;
    }
    
    .checkbox-label {
      display: flex;
      align-items: center;
      gap: 12px;
      cursor: pointer;
      font-weight: 500;
      color: var(--text-primary);
      padding: 8px 0;
    }
    
    .modern-checkbox {
      display: none;
    }
    
    .checkmark {
      width: 20px;
      height: 20px;
      border: 2px solid var(--border);
      border-radius: 6px;
      display: flex;
      align-items: center;
      justify-content: center;
      transition: all 0.2s ease;
    }
    
    .modern-checkbox:checked + .checkmark {
      background: var(--primary);
      border-color: var(--primary);
    }
    
    .modern-checkbox:checked + .checkmark::after {
      content: 'âœ“';
      color: white;
      font-size: 12px;
      font-weight: bold;
    }
    
    .banner-preview-section {
      background: linear-gradient(135deg, #f8fafc 0%, #f1f5f9 100%);
      border-radius: 16px;
      padding: 20px;
      border: 1px solid var(--border-light);
    }
    
    .preview-header {
      display: flex;
      align-items: center;
      justify-content: space-between;
      margin-bottom: 16px;
      font-weight: 600;
      color: var(--text-primary);
    }
    
    .preview-badge {
      background: var(--primary-light);
      color: var(--primary);
      padding: 4px 8px;
      border-radius: 20px;
      font-size: 11px;
      font-weight: 600;
    }
    
    .banner-preview {
      background: linear-gradient(135deg, #6366F1 0%, #8B5CF6 50%, #EC4899 100%);
      border-radius: 16px;
      padding: 24px;
      color: white;
      position: relative;
      overflow: hidden;
      min-height: 120px;
      display: flex;
      align-items: center;
      cursor: pointer;
      transition: transform 0.2s ease;
    }
    
    .banner-preview:hover {
      transform: translateY(-2px);
    }
    
    .banner-content {
      position: relative;
      z-index: 2;
      width: 100%;
    }
    
    .banner-title {
      font-size: 18px;
      font-weight: 700;
      margin-bottom: 6px;
      line-height: 1.3;
    }
    
    .banner-subtitle {
      font-size: 12px;
      opacity: 0.9;
      margin-bottom: 12px;
    }
    
    .banner-badge {
      background: rgba(255, 255, 255, 0.2);
      padding: 4px 8px;
      border-radius: 12px;
      font-size: 11px;
      display: inline-flex;
      align-items: center;
      gap: 4px;
      backdrop-filter: blur(10px);
    }
    
    .banner-gradient-overlay {
      position: absolute;
      top: 0;
      right: 0;
      width: 60%;
      height: 100%;
      background: linear-gradient(90deg, transparent 0%, rgba(255, 255, 255, 0.1) 100%);
      pointer-events: none;
    }
    
    .preview-info {
      display: grid;
      grid-template-columns: repeat(3, 1fr);
      gap: 12px;
      margin-top: 16px;
    }
    
    .info-item {
      display: flex;
      align-items: center;
      gap: 6px;
      font-size: 11px;
      color: var(--text-muted);
      padding: 6px 8px;
      background: var(--bg-secondary);
      border-radius: 8px;
      justify-content: center;
    }
    
    /* ç§»åŠ¨ç«¯å“åº”å¼ */
    @media (max-width: 768px) {
      .banner-config-grid {
        grid-template-columns: 1fr;
        gap: 20px;
      }
      
      .banner-preview-section {
        order: -1;
      }
      
      .banner-preview {
        min-height: 100px;
        padding: 20px;
      }
      
      .banner-title {
        font-size: 16px;
      }
      
      .preview-info {
        grid-template-columns: repeat(2, 1fr);
      }
    }
    
    /* ç”¨æˆ·è¯¦æƒ…æ¨¡æ€æ¡†æ ·å¼ */
    .modal {
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background: rgba(0,0,0,0.5);
      display: flex;
      align-items: center;
      justify-content: center;
      z-index: 1000;
      opacity: 0;
      visibility: hidden;
      transition: all 0.3s ease;
    }

    .modal.show {
      opacity: 1;
      visibility: visible;
    }

    .modal-content {
      background: white;
      border-radius: 12px;
      width: 90%;
      max-width: 500px;
      max-height: 80vh;
      overflow: hidden;
      box-shadow: 0 20px 25px -5px rgba(0,0,0,0.1), 0 10px 10px -5px rgba(0,0,0,0.04);
      transform: translateY(20px);
      transition: transform 0.3s ease;
    }

    .modal.show .modal-content {
      transform: translateY(0);
    }

    .modal-header {
      padding: 16px 20px;
      border-bottom: 1px solid #e5e7eb;
      display: flex;
      align-items: center;
      justify-content: space-between;
    }

    .modal-header h3 {
      margin: 0;
      font-size: 18px;
      font-weight: 600;
      color: #374151;
    }

    .modal-close {
      background: none;
      border: none;
      font-size: 24px;
      cursor: pointer;
      color: #6b7280;
      padding: 0;
      width: 30px;
      height: 30px;
      display: flex;
      align-items: center;
      justify-content: center;
      border-radius: 6px;
    }

    .modal-close:hover {
      background: #f3f4f6;
      color: #374151;
    }

    .modal-body {
      padding: 20px;
    }

    .user-detail-grid {
      display: grid;
      gap: 16px;
    }

    .detail-item {
      display: grid;
      grid-template-columns: 80px 1fr;
      gap: 12px;
      align-items: center;
    }

    .detail-item label {
      font-weight: 500;
      color: #6b7280;
      font-size: 14px;
    }

    .detail-item span {
      color: #374151;
      font-size: 14px;
      word-break: break-all;
    }

    .modal-footer {
      padding: 16px 20px;
      border-top: 1px solid #e5e7eb;
      display: flex;
      justify-content: flex-end;
    }

    .name-cell .name-text {
      cursor: pointer;
      color: #2563eb;
      text-decoration: underline;
    }

    .name-cell .name-text:hover {
      color: #1d4ed8;
    }
  </style>
</body>
</html>
